/*! signature-document.js - 0.0.1 - 2014-10-12 - scottmotte */
var MicroEvent=function(){};MicroEvent.prototype={bind:function(a,b){this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b)},unbind:function(a,b){this._events=this._events||{},a in this._events!=!1&&this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){if(this._events=this._events||{},a in this._events!=!1)for(var b=0;b<this._events[a].length;b++)this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}},MicroEvent.mixin=function(a){for(var b=["bind","unbind","trigger"],c=0;c<b.length;c++)"function"==typeof a?a.prototype[b[c]]=MicroEvent.prototype[b[c]]:a[b[c]]=MicroEvent.prototype[b[c]]},"undefined"!=typeof module&&"exports"in module&&(module.exports=MicroEvent);var fabric=fabric||{version:"1.1.0"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow()),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window;var Cufon=function(){function a(a){var b=this.face=a.face;this.glyphs=a.glyphs,this.w=a.w,this.baseSize=parseInt(b["units-per-em"],10),this.family=b["font-family"].toLowerCase(),this.weight=b["font-weight"],this.style=b["font-style"]||"normal",this.viewBox=function(){var a=b.bbox.split(/\s+/),c={minX:parseInt(a[0],10),minY:parseInt(a[1],10),maxX:parseInt(a[2],10),maxY:parseInt(a[3],10)};return c.width=c.maxX-c.minX,c.height=c.maxY-c.minY,c.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")},c}(),this.ascent=-parseInt(b.ascent,10),this.descent=-parseInt(b.descent,10),this.height=-this.ascent+this.descent}function b(){var a={},b={oblique:"italic",italic:"oblique"};this.add=function(b){(a[b.style]||(a[b.style]={}))[b.weight]=b},this.get=function(c,d){var e=a[c]||a[b[c]]||a.normal||a.italic||a.oblique;if(!e)return null;if(d={normal:400,bold:700}[d]||parseInt(d,10),e[d])return e[d];var f,g,h={1:1,99:0}[d%100],i=[];void 0===h&&(h=d>400),500==d&&(d=400);for(var j in e)j=parseInt(j,10),(!f||f>j)&&(f=j),(!g||j>g)&&(g=j),i.push(j);return f>d&&(d=f),d>g&&(d=g),i.sort(function(a,b){return(h?a>d&&b>d?b>a:a>b:d>a&&d>b?a>b:b>a)?-1:1}),e[i[0]]}}function c(){function a(a,b){return a.contains?a.contains(b):16&a.compareDocumentPosition(b)}function b(b){var c=b.relatedTarget;c&&!a(this,c)&&d(this)}function c(){d(this)}function d(a){setTimeout(function(){n.replace(a,r.get(a).options,!0)},10)}this.attach=function(a){void 0===a.onmouseenter?(f(a,"mouseover",b),f(a,"mouseout",b)):(f(a,"mouseenter",c),f(a,"mouseleave",c))}}function d(){function a(a){return a.cufid||(a.cufid=++c)}var b={},c=0;this.get=function(c){var d=a(c);return b[d]||(b[d]={})}}function e(a){var b={},c={};this.get=function(c){return void 0!=b[c]?b[c]:a[c]},this.getSize=function(a,b){return c[a]||(c[a]=new p.Size(this.get(a),b))},this.extend=function(a){for(var c in a)b[c]=a[c];return this}}function f(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){return c.call(a,fabric.window.event)})}function g(a,b){var c=r.get(a);return c.options?a:(b.hover&&b.hoverables[a.nodeName.toLowerCase()]&&s.attach(a),c.options=b,a)}function h(a){var b={};return function(c){return b.hasOwnProperty(c)||(b[c]=a.apply(null,arguments)),b[c]}}function i(a,b){b||(b=p.getStyle(a));for(var c,d=p.quotedList(b.get("fontFamily").toLowerCase()),e=0,f=d.length;f>e;++e)if(c=d[e],v[c])return v[c].get(b.get("fontStyle"),b.get("fontWeight"));return null}function j(a){return fabric.document.getElementsByTagName(a)}function k(){for(var a,b={},c=0,d=arguments.length;d>c;++c)for(a in arguments[c])b[a]=arguments[c][a];return b}function l(a,b,c,d,e,f){var g=d.separate;if("none"==g)return u[d.engine].apply(null,arguments);var h,i=fabric.document.createDocumentFragment(),j=b.split(x[g]),k="words"==g;k&&q&&(/^\s/.test(b)&&j.unshift(""),/\s$/.test(b)&&j.push(""));for(var l=0,m=j.length;m>l;++l)h=u[d.engine](a,k?p.textAlign(j[l],c,l,m):j[l],c,d,e,f,m-1>l),h&&i.appendChild(h);return i}function m(a,b){for(var c,d,e,f,h=g(a,b).firstChild;h;h=e){if(e=h.nextSibling,f=!1,1==h.nodeType){if(!h.firstChild)continue;if(!/cufon/.test(h.className)){arguments.callee(h,b);continue}f=!0}if(d||(d=p.getStyle(a).extend(b)),c||(c=i(a,d)),c)if(f)u[b.engine](c,null,d,b,h,a);else{var j=h.data;if("undefined"!=typeof G_vmlCanvasManager&&(j=j.replace(/\r/g,"\n")),""!==j){var k=l(c,j,d,b,h,a);k?h.parentNode.replaceChild(k,h):h.parentNode.removeChild(h)}}}}var n=function(){return n.replace.apply(null,arguments)},o=n.DOM={ready:function(){var a=!1,b={loaded:1,complete:1},c=[],d=function(){if(!a){a=!0;for(var b;b=c.shift();b());}};return fabric.document.addEventListener&&(fabric.document.addEventListener("DOMContentLoaded",d,!1),fabric.window.addEventListener("pageshow",d,!1)),!fabric.window.opera&&fabric.document.readyState&&function(){b[fabric.document.readyState]?d():setTimeout(arguments.callee,10)}(),fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left"),d()}catch(a){setTimeout(arguments.callee,1)}}(),f(fabric.window,"load",d),function(b){arguments.length?a?b():c.push(b):d()}}()},p=n.CSS={Size:function(a,b){this.value=parseFloat(a),this.unit=String(a).match(/[a-z%]*$/)[0]||"px",this.convert=function(a){return a/b*this.value},this.convertFrom=function(a){return a/this.value*b},this.toString=function(){return this.value+this.unit}},getStyle:function(a){return new e(a.style)},quotedList:h(function(a){for(var b,c=[],d=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g;b=d.exec(a);)c.push(b[3]||b[1]);return c}),ready:function(){var a=!1,b=[],c=function(){a=!0;for(var c;c=b.shift();c());},d=Object.prototype.propertyIsEnumerable?j("style"):{length:0},e=j("link");return o.ready(function(){for(var a,b=0,f=0,g=e.length;a=e[f],g>f;++f)!a.disabled&&"stylesheet"==a.rel.toLowerCase()&&++b;fabric.document.styleSheets.length>=d.length+b?c():setTimeout(arguments.callee,10)}),function(c){a?c():b.push(c)}}(),supports:function(a,b){var c=fabric.document.createElement("span").style;return void 0===c[a]?!1:(c[a]=b,c[a]===b)},textAlign:function(a,b,c,d){return"right"==b.get("textAlign")?c>0&&(a=" "+a):d-1>c&&(a+=" "),a},textDecoration:function(a,b){b||(b=this.getStyle(a));for(var c={underline:null,overline:null,"line-through":null},d=a;d.parentNode&&1==d.parentNode.nodeType;){var e=!0;for(var f in c)c[f]||(-1!=b.get("textDecoration").indexOf(f)&&(c[f]=b.get("color")),e=!1);if(e)break;b=this.getStyle(d=d.parentNode)}return c},textShadow:h(function(a){if("none"==a)return null;for(var b,c=[],d={},e=0,f=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/gi;b=f.exec(a);)","==b[0]?(c.push(d),d={},e=0):b[1]?d.color=b[1]:d[["offX","offY","blur"][e++]]=b[2];return c.push(d),c}),color:h(function(a){var b={};return b.color=a.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(a,c,d){return b.opacity=parseFloat(d),"rgb("+c+")"}),b}),textTransform:function(a,b){return a[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[b.get("textTransform")]||"toString"]()}},q=0==" ".split(/\s+/).length,r=new d,s=new c,t=[],u={},v={},w={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(a){return jQuery(a)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(a){return $$(a)}||fabric.window.$&&function(a){return $(a)}||fabric.document.querySelectorAll&&function(a){return fabric.document.querySelectorAll(a)}||j,separate:"words",textShadow:"none"},x={words:/\s+/,characters:""};return n.now=function(){return o.ready(),n},n.refresh=function(){for(var a=t.splice(0,t.length),b=0,c=a.length;c>b;++b)n.replace.apply(null,a[b]);return n},n.registerEngine=function(a,b){return b?(u[a]=b,n.set("engine",a)):n},n.registerFont=function(c){var d=new a(c),e=d.family;return v[e]||(v[e]=new b),v[e].add(d),n.set("fontFamily",'"'+e+'"')},n.replace=function(a,b,c){return b=k(w,b),b.engine?("string"==typeof b.textShadow&&b.textShadow&&(b.textShadow=p.textShadow(b.textShadow)),c||t.push(arguments),(a.nodeType||"string"==typeof a)&&(a=[a]),p.ready(function(){for(var c=0,d=a.length;d>c;++c){var e=a[c];"string"==typeof e?n.replace(b.selector(e),b,!0):m(e,b)}}),n):n},n.replaceElement=function(a,b){return b=k(w,b),"string"==typeof b.textShadow&&b.textShadow&&(b.textShadow=p.textShadow(b.textShadow)),m(a,b)},n.engines=u,n.fonts=v,n.getOptions=function(){return k(w)},n.set=function(a,b){return w[a]=b,n},n}();Cufon.registerEngine("canvas",function(){function a(a,b){var c,d=0,e=0,f=[],g=/([mrvxe])([^a-z]*)/g;a:for(var h=0;c=g.exec(a);++h){var i=c[2].split(",");switch(c[1]){case"v":f[h]={m:"bezierCurveTo",a:[d+~~i[0],e+~~i[1],d+~~i[2],e+~~i[3],d+=~~i[4],e+=~~i[5]]};break;case"r":f[h]={m:"lineTo",a:[d+=~~i[0],e+=~~i[1]]};break;case"m":f[h]={m:"moveTo",a:[d=~~i[0],e=~~i[1]]};break;case"x":f[h]={m:"closePath",a:[]};break;case"e":break a}b[f[h].m].apply(b,f[h].a)}return f}function b(a,b){for(var c=0,d=a.length;d>c;++c){var e=a[c];b[e.m].apply(b,e.a)}}var c=Cufon.CSS.supports("display","inline-block"),d=!c&&("BackCompat"==fabric.document.compatMode||/frameset|transitional/i.test(fabric.document.doctype.publicId)),e=fabric.document.createElement("style");e.type="text/css";var f=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(d?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(c?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{e.appendChild(f)}catch(g){e.setAttribute("type","text/css"),e.styleSheet.cssText=f.data}return fabric.document.getElementsByTagName("head")[0].appendChild(e),function(d,e,f,g,h){function i(){T.save();var a=0,b=0,c=[{left:0}];g.backgroundColor&&(T.save(),T.fillStyle=g.backgroundColor,T.translate(0,d.ascent),T.fillRect(0,0,A+10,(-d.ascent+d.descent)*D),T.restore()),"right"===g.textAlign?(T.translate(G[b],0),c[0].left=G[b]*U):"center"===g.textAlign&&(T.translate(G[b]/2,0),c[0].left=G[b]/2*U);for(var e=0,f=z.length;f>e;++e)if("\n"!==z[e]){var h=d.glyphs[z[e]]||d.missingGlyph;if(h){var i=Number(h.w||d.w)+n;g.textBackgroundColor&&(T.save(),T.fillStyle=g.textBackgroundColor,T.translate(0,d.ascent),T.fillRect(0,0,i+10,-d.ascent+d.descent),T.restore()),T.translate(i,0),a+=i,e==f-1&&(c[c.length-1].width=a*U,c[c.length-1].height=(-d.ascent+d.descent)*U)}}else{b++;var j=-d.ascent-d.ascent/5*g.lineHeight,k=c[c.length-1],l={left:0};k.width=a*U,k.height=(-d.ascent+d.descent)*U,"right"===g.textAlign?(T.translate(-A,j),T.translate(G[b],0),l.left=G[b]*U):"center"===g.textAlign?(T.translate(-a-G[b-1]/2,j),T.translate(G[b]/2,0),l.left=G[b]/2*U):T.translate(-a,j),c.push(l),a=0}T.restore(),Cufon.textOptions.boundaries=c}function j(c){T.fillStyle=c||Cufon.textOptions.color||f.get("color");var e=0,h=0;"right"===g.textAlign?T.translate(G[h],0):"center"===g.textAlign&&T.translate(G[h]/2,0);for(var i=0,j=z.length;j>i;++i)if("\n"!==z[i]){var k=d.glyphs[z[i]]||d.missingGlyph;if(k){var l=Number(k.w||d.w)+n;W&&(T.save(),T.strokeStyle=T.fillStyle,T.lineWidth+=T.lineWidth,T.beginPath(),W.underline&&(T.moveTo(0,-d.face["underline-position"]+.5),T.lineTo(l,-d.face["underline-position"]+.5)),W.overline&&(T.moveTo(0,d.ascent+.5),T.lineTo(l,d.ascent+.5)),W["line-through"]&&(T.moveTo(0,-d.descent+.5),T.lineTo(l,-d.descent+.5)),T.stroke(),T.restore()),X&&(T.save(),T.transform(1,0,-.25,1,0,0)),T.beginPath(),k.d&&(k.code?b(k.code,T):k.code=a("m"+k.d,T)),T.fill(),g.strokeStyle&&(T.closePath(),T.save(),T.lineWidth=g.strokeWidth,T.strokeStyle=g.strokeStyle,T.stroke(),T.restore()),X&&T.restore(),T.translate(l,0),e+=l}}else{h++;var m=-d.ascent-d.ascent/5*g.lineHeight;"right"===g.textAlign?(T.translate(-A,m),T.translate(G[h],0)):"center"===g.textAlign?(T.translate(-e-G[h-1]/2,m),T.translate(G[h]/2,0)):T.translate(-e,m),e=0}}var k=null===e,l=d.viewBox,m=f.getSize("fontSize",d.baseSize),n=f.get("letterSpacing");n="normal"==n?0:m.convertFrom(parseInt(n,10));var o=0,p=0,q=0,r=0,s=g.textShadow,t=[];if(Cufon.textOptions.shadowOffsets=[],Cufon.textOptions.shadows=null,s){Cufon.textOptions.shadows=s;for(var u=0,v=s.length;v>u;++u){var w=s[u],x=m.convertFrom(parseFloat(w.offX)),y=m.convertFrom(parseFloat(w.offY));t[u]=[x,y]}}for(var z=Cufon.CSS.textTransform(k?h.alt:e,f).split(""),A=0,B=null,C=0,D=1,E=[],u=0,v=z.length;v>u;++u)if("\n"!==z[u]){var F=d.glyphs[z[u]]||d.missingGlyph;F&&(A+=B=Number(F.w||d.w)+n)}else D++,A>C&&(C=A),E.push(A),A=0;E.push(A),A=Math.max(C,A);for(var G=[],u=E.length;u--;)G[u]=A-E[u];if(null===B)return null;p+=l.width-B,r+=l.minX;var H,I;if(k)H=h,I=h.firstChild;else if(H=fabric.document.createElement("span"),H.className="cufon cufon-canvas",H.alt=e,I=fabric.document.createElement("canvas"),H.appendChild(I),g.printable){var J=fabric.document.createElement("span");J.className="cufon-alt",J.appendChild(fabric.document.createTextNode(e)),H.appendChild(J)}var K=H.style,L=I.style||{},M=m.convert(l.height-o+q),N=Math.ceil(M),O=N/M;I.width=Math.ceil(m.convert(A+p-r)*O),I.height=N,o+=l.minY,L.top=Math.round(m.convert(o-d.ascent))+"px",L.left=Math.round(m.convert(r))+"px";var P=Math.ceil(m.convert(A*O)),Q=P+"px",R=m.convert(d.height),S=(g.lineHeight-1)*m.convert(-d.ascent/5)*(D-1);Cufon.textOptions.width=P,Cufon.textOptions.height=R*D+S,Cufon.textOptions.lines=D,Cufon.textOptions.totalLineHeight=S,c?(K.width=Q,K.height=R+"px"):(K.paddingLeft=Q,K.paddingBottom=R-1+"px");var T=Cufon.textOptions.context||I.getContext("2d"),U=N/l.height;Cufon.textOptions.fontAscent=d.ascent*U,Cufon.textOptions.boundaries=null;for(var V=Cufon.textOptions.shadowOffsets,u=t.length;u--;)V[u]=[t[u][0]*U,t[u][1]*U];T.save(),T.scale(U,U),T.translate(-r-1/U*I.width/2+(Cufon.fonts[d.family].offsetLeft||0),-o-Cufon.textOptions.height/U/2+(Cufon.fonts[d.family].offsetTop||0)),T.lineWidth=d.face["underline-thickness"],T.save();var W=Cufon.getTextDecoration(g),X="italic"===g.fontStyle;if(T.save(),i(),s)for(var u=0,v=s.length;v>u;++u){var w=s[u];T.save(),T.translate.apply(T,t[u]),j(w.color),T.restore()}return j(),T.restore(),T.restore(),T.restore(),H}}()),Cufon.registerEngine("vml",function(){function a(a,c){return b(a,/(?:em|ex|%)$/i.test(c)?"1em":c)}function b(a,b){if(/px$/i.test(b))return parseFloat(b);var c=a.style.left,d=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left,a.style.left=b;var e=a.style.pixelLeft;return a.style.left=c,a.runtimeStyle.left=d,e}if(fabric.document.namespaces){var c=fabric.document.createElement("canvas");if(!(c&&c.getContext&&c.getContext.apply)){null==fabric.document.namespaces.cvml&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml");var d=fabric.document.createElement("cvml:shape");if(d.style.behavior="url(#default#VML)",d.coordsize)return d=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>'),function(c,d,e,f,g,h,i){var j=null===d;j&&(d=g.alt);var k=c.viewBox,l=e.computedFontSize||(e.computedFontSize=new Cufon.CSS.Size(a(h,e.get("fontSize"))+"px",c.baseSize)),m=e.computedLSpacing;void 0==m&&(m=e.get("letterSpacing"),e.computedLSpacing=m="normal"==m?0:~~l.convertFrom(b(h,m)));var n,o;if(j)n=g,o=g.firstChild;else{if(n=fabric.document.createElement("span"),n.className="cufon cufon-vml",n.alt=d,o=fabric.document.createElement("span"),o.className="cufon-vml-canvas",n.appendChild(o),f.printable){var p=fabric.document.createElement("span");p.className="cufon-alt",p.appendChild(fabric.document.createTextNode(d)),n.appendChild(p)}i||n.appendChild(fabric.document.createElement("cvml:shape"))}var q=n.style,r=o.style,s=l.convert(k.height),t=Math.ceil(s),u=t/s,v=k.minX,w=k.minY;r.height=t,r.top=Math.round(l.convert(w-c.ascent)),r.left=Math.round(l.convert(v)),q.height=l.convert(c.height)+"px";for(var x,y,z=(Cufon.getTextDecoration(f),e.get("color")),A=Cufon.CSS.textTransform(d,e).split(""),B=0,C=0,D=null,E=f.textShadow,F=0,G=0,H=A.length;H>F;++F)x=c.glyphs[A[F]]||c.missingGlyph,x&&(B+=D=~~(x.w||c.w)+m);if(null===D)return null;var I,J=-v+B+(k.width-D),K=l.convert(J*u),L=Math.round(K),M=J+","+k.height,N="r"+M+"nsnf";for(F=0;H>F;++F)if(x=c.glyphs[A[F]]||c.missingGlyph){j?(y=o.childNodes[G],y.firstChild&&y.removeChild(y.firstChild)):(y=fabric.document.createElement("cvml:shape"),o.appendChild(y)),y.stroked="f",y.coordsize=M,y.coordorigin=I=v-C+","+w,y.path=(x.d?"m"+x.d+"xe":"")+"m"+I+N,y.fillcolor=z;var O=y.style;if(O.width=L,O.height=t,E){var P,Q=E[0],R=E[1],S=Cufon.CSS.color(Q.color),T=fabric.document.createElement("cvml:shadow");T.on="t",T.color=S.color,T.offset=Q.offX+","+Q.offY,R&&(P=Cufon.CSS.color(R.color),T.type="double",T.color2=P.color,T.offset2=R.offX+","+R.offY),T.opacity=S.opacity||P&&P.opacity||1,y.appendChild(T)}C+=~~(x.w||c.w)+m,++G}return q.width=Math.max(Math.ceil(l.convert(B*u)),0),n}}}}()),Cufon.getTextDecoration=function(a){return{underline:"underline"===a.textDecoration,overline:"overline"===a.textDecoration,"line-through":"line-through"===a.textDecoration}},"undefined"!=typeof exports&&(exports.Cufon=Cufon);var JSON;JSON||(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","  ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,!b||"function"==typeof b||"object"==typeof b&&"number"==typeof b.length)return str("",{"":a});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&("undefined"!=typeof console.log&&console.log.apply&&(fabric.log=function(){return console.log.apply(console,arguments)}),"undefined"!=typeof console.warn&&console.warn.apply&&(fabric.warn=function(){return console.warn.apply(console,arguments)})),fabric.Observable={observe:function(a,b){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b)},stopObserving:function(a,b){this.__eventListeners||(this.__eventListeners={}),this.__eventListeners[a]&&(b?fabric.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)},fire:function(a,b){this.__eventListeners||(this.__eventListeners={});var c=this.__eventListeners[a];if(c)for(var d=0,e=c.length;e>d;d++)c[d](b||{})}},fabric.Observable.on=fabric.Observable.observe,fabric.Observable.off=fabric.Observable.stopObserving,fabric.Observable.trigger=fabric.Observable.fire,function(){function a(a,b){var c=a.indexOf(b);return-1!==c&&a.splice(c,1),a}function b(a,b){return Math.floor(Math.random()*(b-a+1))+a}function c(a){return a*s}function d(a){return a/s}function e(a,b,c){var d=Math.sin(c),e=Math.cos(c);a.subtractEquals(b);var f=a.x*e-a.y*d,g=a.x*d+a.y*e;return new fabric.Point(f,g).addEquals(b)}function f(a,b){return parseFloat(Number(a).toFixed(b))}function g(){return!1}function h(a){a||(a={});var b,c=+new Date,d=a.duration||500,e=c+d,f=a.onChange||function(){},g=a.abort||function(){return!1},h=a.easing||function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},i="startValue"in a?a.startValue:0,j="endValue"in a?a.endValue:100,k=a.byValue||j-i;a.onStart&&a.onStart(),function l(){b=+new Date;var j=b>e?d:b-c;return f(h(j,i,k,d)),b>e||g()?void(a.onComplete&&a.onComplete()):void u(l)}()}function i(a,b,c){if(a){var d=new Image;d.onload=function(){b&&b.call(c,d),d=d.onload=null},d.src=a}else b&&b.call(c,a)}function j(a,b){function c(a){return fabric[fabric.util.string.camelize(fabric.util.string.capitalize(a))]}function d(){++f===g&&b&&b(e)}var e=[],f=0,g=a.length;a.forEach(function(a,b){if(a.type){var f=c(a.type);f.async?f.fromObject(a,function(a,c){c||(e[b]=a),d()}):(e[b]=f.fromObject(a),d())}})}function k(a,b,c){var d;if(a.length>1){var e=a.some(function(a){return"text"===a.type});e?(d=new fabric.Group([],b),a.reverse().forEach(function(a){a.cx&&(a.left=a.cx),a.cy&&(a.top=a.cy),d.addWithUpdate(a)})):d=new fabric.PathGroup(a,b)}else d=a[0];return"undefined"!=typeof c&&d.setSourcePath(c),d}function l(a,b,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var d=0,e=c.length;e>d;d++)b[c[d]]=a[c[d]]}function m(a,b,c,d,e,f){var g=d-b,h=e-c,i=q(g*g+h*h),j=r(h,g),k=f.length,l=0,m=!0;for(a.save(),a.translate(b,c),a.moveTo(0,0),a.rotate(j),b=0;i>b;)b+=f[l++%k],b>i&&(b=i),a[m?"lineTo":"moveTo"](b,0),m=!m;a.restore()}function n(a){return a||(a=fabric.document.createElement("canvas")),!a.getContext&&"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(a),a}function o(a){for(var b=a.prototype,c=b.stateProperties.length;c--;){var d=b.stateProperties[c],e=d.charAt(0).toUpperCase()+d.slice(1),f="set"+e,g="get"+e;b[g]||(b[g]=function(a){return new Function('return this.get("'+a+'")')}(d)),b[f]||(b[f]=function(a){return new Function("value",'return this.set("'+a+'", value)')}(d))}}function p(a,b){b.save(),b.beginPath(),a.clipTo(b),b.clip()}var q=Math.sqrt,r=Math.atan2;fabric.util={};var s=Math.PI/180,t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1e3/60)},u=function(){return t.apply(fabric.window,arguments)};fabric.util.removeFromArray=a,fabric.util.degreesToRadians=c,fabric.util.radiansToDegrees=d,fabric.util.rotatePoint=e,fabric.util.toFixed=f,fabric.util.getRandomInt=b,fabric.util.falseFunction=g,fabric.util.animate=h,fabric.util.requestAnimFrame=u,fabric.util.loadImage=i,fabric.util.enlivenObjects=j,fabric.util.groupSVGElements=k,fabric.util.populateWithProperties=l,fabric.util.drawDashedLine=m,fabric.util.createCanvasElement=n,fabric.util.createAccessors=o,fabric.util.clipContext=p}(),function(){function a(a,b){for(var c=d.call(arguments,2),e=[],f=0,g=a.length;g>f;f++)e[f]=c.length?a[f][b].apply(a[f],c):a[f][b].call(a[f]);return e}function b(a,b){if(!a||0===a.length)return void 0;var c=a.length-1,d=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]>=d&&(d=a[c][b]);else for(;c--;)a[c]>=d&&(d=a[c]);return d}function c(a,b){if(!a||0===a.length)return void 0;var c=a.length-1,d=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]<d&&(d=a[c][b]);else for(;c--;)a[c]<d&&(d=a[c]);return d}var d=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==Number.POSITIVE_INFINITY&&d!==Number.NEGATIVE_INFINITY&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)c in this&&a.call(b,this[c],c,this)}),Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=[],d=0,e=this.length>>>0;e>d;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c}),Array.prototype.every||(Array.prototype.every=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var c,d=[],e=0,f=this.length>>>0;f>e;e++)e in this&&(c=this[e],a.call(b,c,e,this)&&d.push(c));return d}),Array.prototype.reduce||(Array.prototype.reduce=function(a){var b,c=this.length>>>0,d=0;if(arguments.length>1)b=arguments[1];else for(;;){if(d in this){b=this[d++];break}if(++d>=c)throw new TypeError}for(;c>d;d++)d in this&&(b=a.call(null,b,this[d],d,this));return b}),fabric.util.array={invoke:a,min:c,max:b}}(),function(){function a(a,b){for(var c in b)a[c]=b[c];return a}function b(b){return a({},b)}fabric.util.object={extend:a,clone:b}}(),function(){function a(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function b(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()}function c(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:a,capitalize:b,escapeXml:c}}(),function(){var a=Array.prototype.slice,b=Function.prototype.apply,c=function(){};Function.prototype.bind||(Function.prototype.bind=function(d){var e,f=this,g=a.call(arguments,1);return e=g.length?function(){return b.call(f,this instanceof c?this:d,g.concat(a.call(arguments)))}:function(){return b.call(f,this instanceof c?this:d,arguments)},c.prototype=this.prototype,e.prototype=new c,e})}(),function(){function a(){}function b(a){var b=this.constructor.superclass.prototype[a];return arguments.length>1?b.apply(this,d.call(arguments,1)):b.call(this)}function c(){function c(){this.initialize.apply(this,arguments)}var f=null,h=d.call(arguments,0);"function"==typeof h[0]&&(f=h.shift()),c.superclass=f,c.subclasses=[],f&&(a.prototype=f.prototype,c.prototype=new a,f.subclasses.push(c));for(var i=0,j=h.length;j>i;i++)g(c,h[i],f);return c.prototype.initialize||(c.prototype.initialize=e),c.prototype.constructor=c,c.prototype.callSuper=b,c}var d=Array.prototype.slice,e=function(){},f=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(a,b,c){for(var d in b)a.prototype[d]=d in a.prototype&&"function"==typeof a.prototype[d]&&(b[d]+"").indexOf("callSuper")>-1?function(a){return function(){var d=this.constructor.superclass;this.constructor.superclass=c;var e=b[a].apply(this,arguments);return this.constructor.superclass=d,"initialize"!==a?e:void 0}}(d):b[d],f&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=c}(),function(){function a(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=d.length;for(c=0;e>c;c++)if(b=typeof a[d[c]],!/^(?:function|object|unknown)$/.test(b))return!1;return!0}function b(a,b){return{handler:b,wrappedHandler:c(a,b)}}function c(a,b){return function(c){b.call(f(a),c||fabric.window.event)}}function d(a,b){return function(c){if(n[a]&&n[a][b])for(var d=n[a][b],e=0,f=d.length;f>e;e++)d[e].call(this,c||fabric.window.event)}}function e(a,b){a||(a=fabric.window.event);for(var c,d=a.target||("unknown"!=typeof a.srcElement?a.srcElement:null),e=fabric.document.body||{scrollLeft:0,scrollTop:0},f=fabric.document.documentElement,g=d,h=0,i=0;d&&d.parentNode&&!c;)d=d.parentNode,d!==fabric.document&&"fixed"===fabric.util.getElementPosition(d)&&(c=d),d!==fabric.document&&g!==b&&"absolute"===fabric.util.getElementPosition(d)?(h=0,i=0):d===fabric.document&&g!==b?(h=e.scrollLeft||f.scrollLeft||0,i=e.scrollTop||f.scrollTop||0):(h+=d.scrollLeft||0,i+=d.scrollTop||0);return{x:o(a)+h,y:p(a)+i}}var f,g,h=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();!function(){var a={};f=function(b){return a[b]},g=function(b,c){a[b]=c}}();var i,j,k=a(fabric.document.documentElement,"addEventListener","removeEventListener")&&a(fabric.window,"addEventListener","removeEventListener"),l=a(fabric.document.documentElement,"attachEvent","detachEvent")&&a(fabric.window,"attachEvent","detachEvent"),m={},n={};k?(i=function(a,b,c){a.addEventListener(b,c,!1)},j=function(a,b,c){a.removeEventListener(b,c,!1)}):l?(i=function(a,c,d){var e=h(a);g(e,a),m[e]||(m[e]={}),m[e][c]||(m[e][c]=[]);var f=b(e,d);m[e][c].push(f),a.attachEvent("on"+c,f.wrappedHandler)},j=function(a,b,c){var d,e=h(a);if(m[e]&&m[e][b])for(var f=0,g=m[e][b].length;g>f;f++)d=m[e][b][f],d&&d.handler===c&&(a.detachEvent("on"+b,d.wrappedHandler),m[e][b][f]=null)}):(i=function(a,b,c){var e=h(a);if(n[e]||(n[e]={}),!n[e][b]){n[e][b]=[];var f=a["on"+b];f&&n[e][b].push(f),a["on"+b]=d(e,b)}n[e][b].push(c)},j=function(a,b,c){var d=h(a);if(n[d]&&n[d][b])for(var e=n[d][b],f=0,g=e.length;g>f;f++)e[f]===c&&e.splice(f,1)}),fabric.util.addListener=i,fabric.util.removeListener=j;var o=function(a){return"unknown"!=typeof a.clientX?a.clientX:0},p=function(a){return"unknown"!=typeof a.clientY?a.clientY:0};fabric.isTouchSupported&&(o=function(a){return"touchend"!==a.type?a.touches&&a.touches[0]?a.touches[0].pageX-(a.touches[0].pageX-a.touches[0].clientX)||a.clientX:a.clientX:a.changedTouches&&a.changedTouches[0]?a.changedTouches[0].pageX-(a.changedTouches[0].pageX-a.changedTouches[0].clientX)||a.clientX:a.clientX
},p=function(a){return"touchend"!==a.type?a.touches&&a.touches[0]?a.touches[0].pageY-(a.touches[0].pageY-a.touches[0].clientY)||a.clientY:a.clientY:a.changedTouches&&a.changedTouches[0]?a.changedTouches[0].pageY-(a.changedTouches[0].pageY-a.changedTouches[0].clientY)||a.clientY:a.clientY}),fabric.util.getPointer=e,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function a(a,b){var c=a.style;if(!c)return a;if("string"==typeof b)return a.style.cssText+=";"+b,b.indexOf("opacity")>-1?f(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in b)if("opacity"===d)f(a,b[d]);else{var e="float"===d||"cssFloat"===d?"undefined"==typeof c.styleFloat?"cssFloat":"styleFloat":d;c[e]=b[d]}return a}var b=fabric.document.createElement("div"),c="string"==typeof b.style.opacity,d="string"==typeof b.style.filter,e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(a){return a};c?f=function(a,b){return a.style.opacity=b,a}:d&&(f=function(a,b){var c=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1),e.test(c.filter)?(b=b>=.9999?"":"alpha(opacity="+100*b+")",c.filter=c.filter.replace(e,b)):c.filter+=" alpha(opacity="+100*b+")",a}),fabric.util.setStyle=a}(),function(){function a(a){return"string"==typeof a?fabric.document.getElementById(a):a}function b(a,b){var c=fabric.document.createElement(a);for(var d in b)"class"===d?c.className=b[d]:"for"===d?c.htmlFor=b[d]:c.setAttribute(d,b[d]);return c}function c(a,b){-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)}function d(a,c,d){return"string"==typeof c&&(c=b(c,d)),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a),c}function e(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{left:c,top:b}}var f,g=Array.prototype.slice,h=function(a){return g.call(a,0)};try{f=h(fabric.document.childNodes)instanceof Array}catch(i){}f||(h=function(a){for(var b=new Array(a.length),c=a.length;c--;)b[c]=a[c];return b});var j;j=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a){return fabric.document.defaultView.getComputedStyle(a,null).position}:function(a){var b=a.style.position;return!b&&a.currentStyle&&(b=a.currentStyle.position),b},function(){function a(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction),d?a.style[d]="none":"string"==typeof a.unselectable&&(a.unselectable="on"),a}function b(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=null),d?a.style[d]="":"string"==typeof a.unselectable&&(a.unselectable=""),a}var c=fabric.document.documentElement.style,d="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=a,fabric.util.makeElementSelectable=b}(),function(){function a(a,b){var c=fabric.document.getElementsByTagName("head")[0],d=fabric.document.createElement("script"),e=!0;d.type="text/javascript",d.setAttribute("runat","server"),d.onload=d.onreadystatechange=function(a){if(e){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;e=!1,b(a||fabric.window.event),d=d.onload=d.onreadystatechange=null}},d.src=a,c.appendChild(d)}fabric.util.getScript=a}(),fabric.util.getById=a,fabric.util.toArray=h,fabric.util.makeElement=b,fabric.util.addClass=c,fabric.util.wrapElement=d,fabric.util.getElementOffset=e,fabric.util.getElementPosition=j}(),function(){function a(a,b){return a+(/\?/.test(a)?"&":"?")+b}function b(){}function c(c,e){e||(e={});var f,g=e.method?e.method.toUpperCase():"GET",h=e.onComplete||function(){},i=d();return i.onreadystatechange=function(){4===i.readyState&&(h(i),i.onreadystatechange=b)},"GET"===g&&(f=null,"string"==typeof e.parameters&&(c=a(c,e.parameters))),i.open(g,c,!0),("POST"===g||"PUT"===g)&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(f),i}var d=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{var c=a[b]();if(c)return a[b]}catch(d){}}();fabric.util.request=c}(),function(){function a(a,b,c,d){return c*(a/=d)*a+b}function b(a,b,c,d){return-c*(a/=d)*(a-2)+b}function c(a,b,c,d){return a/=d/2,1>a?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b}function d(a,b,c,d){return c*(a/=d)*a*a+b}function e(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b}function f(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b}function g(a,b,c,d){return c*(a/=d)*a*a*a+b}function h(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b}function i(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b}function j(a,b,c,d){return c*(a/=d)*a*a*a*a+b}function k(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b}function l(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b}function m(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b}function n(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b}function o(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}function p(a,b,c,d){return 0===a?b:c*Math.pow(2,10*(a/d-1))+b}function q(a,b,c,d){return a===d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b}function r(a,b,c,d){return 0===a?b:a===d?b+c:(a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b)}function s(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b}function t(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b}function u(a,b,c,d){return a/=d/2,1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b}function v(a,b,c,d){var e=1.70158,f=0,g=c;return 0===a?b:(a/=d,1===a?b+c:(f||(f=.3*d),g<Math.abs(c)?(g=c,e=f/4):e=f/(2*Math.PI)*Math.asin(c/g),-(g*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-e)*Math.PI/f))+b))}function w(a,b,c,d){var e=1.70158,f=0,g=c;return 0===a?b:(a/=d,1===a?b+c:(f||(f=.3*d),g<Math.abs(c)?(g=c,e=f/4):e=f/(2*Math.PI)*Math.asin(c/g),g*Math.pow(2,-10*a)*Math.sin(2*(a*d-e)*Math.PI/f)+c+b))}function x(a,b,c,d){var e=1.70158,f=0,g=c;return 0===a?b:(a/=d/2,2===a?b+c:(f||(f=.3*d*1.5),g<Math.abs(c)?(g=c,e=f/4):e=f/(2*Math.PI)*Math.asin(c/g),1>a?-.5*g*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-e)*Math.PI/f)+b:g*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-e)*Math.PI/f)*.5+c+b))}function y(a,b,c,d,e){return void 0===e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b}function z(a,b,c,d,e){return void 0===e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b}function A(a,b,c,d,e){return void 0===e&&(e=1.70158),a/=d/2,1>a?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b}function B(a,b,c,d){return c-C(d-a,0,c,d)+b}function C(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b}function D(a,b,c,d){return d/2>a?.5*B(2*a,0,c,d)+b:.5*C(2*a-d,0,c,d)+.5*c+b}fabric.util.ease={easeInQuad:a,easeOutQuad:b,easeInOutQuad:c,easeInCubic:d,easeOutCubic:e,easeInOutCubic:f,easeInQuart:g,easeOutQuart:h,easeInOutQuart:i,easeInQuint:j,easeOutQuint:k,easeInOutQuint:l,easeInSine:m,easeOutSine:n,easeInOutSine:o,easeInExpo:p,easeOutExpo:q,easeInOutExpo:r,easeInCirc:s,easeOutCirc:t,easeInOutCirc:u,easeInElastic:v,easeOutElastic:w,easeInOutElastic:x,easeInBack:y,easeOutBack:z,easeInOutBack:A,easeInBounce:B,easeOutBounce:C,easeInOutBounce:D}}(),function(a){"use strict";function b(a){return a in s?s[a]:a}function c(a,c){if(a){var d,e,f={};a.parentNode&&/^g$/i.test(a.parentNode.nodeName)&&(f=o.parseAttributes(a.parentNode,c));var g=c.reduce(function(c,f){return d=a.getAttribute(f),e=parseFloat(d),d&&(("fill"===f||"stroke"===f)&&"none"===d&&(d=""),"fill-rule"===f&&(d="evenodd"===d?"destination-over":d),"transform"===f&&(d=o.parseTransformAttribute(d)),f=b(f),c[f]=isNaN(e)?d:e),c},{});return g=p(g,p(i(a),o.parseStyleAttribute(a))),p(f,g)}}function d(a){if(!a)return null;a=a.trim();var b=a.indexOf(",")>-1;a=a.split(/\s+/);var c,d,e=[];if(b)for(c=0,d=a.length;d>c;c++){var f=a[c].split(",");e.push({x:parseFloat(f[0]),y:parseFloat(f[1])})}else for(c=0,d=a.length;d>c;c+=2)e.push({x:parseFloat(a[c]),y:parseFloat(a[c+1])});return e.length%2!==0,e}function e(a){var c={},d=a.getAttribute("style");if(!d)return c;if("string"==typeof d)d=d.replace(/;$/,"").split(";").forEach(function(a){var d=a.split(":"),e=d[1].trim(),f=parseFloat(e);c[b(d[0].trim().toLowerCase())]=isNaN(f)?e:f});else for(var e in d)if("undefined"!=typeof d[e]){var f=parseFloat(d[e]);c[b(e.toLowerCase())]=isNaN(f)?d[e]:f}return c}function f(a){for(var b=a.length;b--;){var c=a[b].get("fill");if(/^url\(/.test(c)){var d=c.slice(5,c.length-1);o.gradientDefs[d]&&a[b].set("fill",o.Gradient.fromElement(o.gradientDefs[d],a[b]))}}}function g(a,b,c,d){function e(){0===--i&&(h=h.filter(function(a){return null!=a}),f(h),b(h))}for(var g,h=new Array(a.length),i=a.length,j=0,k=a.length;k>j;j++){g=a[j];var l=o[q(g.tagName)];if(l&&l.fromElement)try{if(l.async)l.fromElement(g,function(a,b){return function(c){d&&d(b,c),h.splice(a,0,c),e()}}(j),c);else{var m=l.fromElement(g,c);d&&d(g,m),h.splice(j,0,m),e()}}catch(n){o.log(n)}else e()}}function h(a){for(var b,c=a.getElementsByTagName("style"),d={},e=0,f=c.length;f>e;e++){var g=c[0].textContent;g=g.replace(/\/\*[\s\S]*?\*\//g,""),b=g.match(/[^{]*\{[\s\S]*?\}/g),b=b.map(function(a){return a.trim()}),b.forEach(function(a){var b=a.match(/([\s\S]*?)\s*\{([^}]*)\}/);a=b[1];var c=b[2].trim(),e=c.replace(/;$/,"").split(/\s*;\s*/);d[a]||(d[a]={});for(var f=0,g=e.length;g>f;f++){var h=e[f].split(/\s*:\s*/),i=h[0],j=h[1];d[a][i]=j}})}return d}function i(a){var b=a.nodeName,c=a.getAttribute("class"),d=a.getAttribute("id"),e={};for(var f in o.cssRules){var g=c&&new RegExp("^\\."+c).test(f)||d&&new RegExp("^#"+d).test(f)||new RegExp("^"+b).test(f);if(g)for(var h in o.cssRules[f])e[h]=o.cssRules[f][h]}return e}function j(a,b,c){function d(d){var e=d.responseXML;!e.documentElement&&o.window.ActiveXObject&&d.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(d.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e.documentElement&&o.parseSVGDocument(e.documentElement,function(c,d){t.set(a,{objects:o.util.array.invoke(c,"toObject"),options:d}),b(c,d)},c)}a=a.replace(/^\n\s*/,"").trim(),t.has(a,function(c){c?t.get(a,function(a){var c=k(a);b(c.objects,c.options)}):new o.util.request(a,{method:"get",onComplete:d})})}function k(a){var b=a.objects,c=a.options;return b=b.map(function(a){return o[q(a.type)].fromObject(a)}),{objects:b,options:c}}function l(a,b,c){a=a.trim();var d;if("undefined"!=typeof DOMParser){var e=new DOMParser;e&&e.parseFromString&&(d=e.parseFromString(a,"text/xml"))}else o.window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));o.parseSVGDocument(d.documentElement,function(a,c){b(a,c)},c)}function m(a){for(var b="",c=0,d=a.length;d>c;c++)"text"===a[c].type&&a[c].path&&(b+=["@font-face {","font-family: ",a[c].fontFamily,"; ","src: url('",a[c].path,"')","}"].join(""));return b&&(b=['<style type="text/css">',"<![CDATA[",b,"]]>","</style>"].join("")),b}function n(a){var b="";return a.backgroundColor&&a.backgroundColor.source&&(b=['<pattern x="0" y="0" id="backgroundColorPattern" ','width="',a.backgroundColor.source.width,'" height="',a.backgroundColor.source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',a.backgroundColor.source.width,'" height="',a.backgroundColor.source.height,'" xlink:href="',a.backgroundColor.source.src,'"></image></pattern>'].join("")),b}var o=a.fabric||(a.fabric={}),p=o.util.object.extend,q=o.util.string.capitalize,r=o.util.object.clone,s={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix","text-decoration":"textDecoration","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle","font-family":"fontFamily"};o.parseTransformAttribute=function(){function a(a,b){var c=b[0];a[0]=Math.cos(c),a[1]=Math.sin(c),a[2]=-Math.sin(c),a[3]=Math.cos(c)}function b(a,b){var c=b[0],d=2===b.length?b[1]:b[0];a[0]=c,a[3]=d}function c(a,b){a[2]=b[0]}function d(a,b){a[1]=b[0]}function e(a,b){a[4]=b[0],2===b.length&&(a[5]=b[1])}var f=[1,0,0,1,0,0],g="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",h="(?:\\s+,?\\s*|,\\s*)",i="(?:(skewX)\\s*\\(\\s*("+g+")\\s*\\))",j="(?:(skewY)\\s*\\(\\s*("+g+")\\s*\\))",k="(?:(rotate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+")"+h+"("+g+"))?\\s*\\))",l="(?:(scale)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",m="(?:(translate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",n="(?:(matrix)\\s*\\(\\s*("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")\\s*\\))",o="(?:"+n+"|"+m+"|"+l+"|"+k+"|"+i+"|"+j+")",p="(?:"+o+"(?:"+h+o+")*)",q="^\\s*(?:"+p+"?)\\s*$",r=new RegExp(q),s=new RegExp(o);return function(g){var h=f.concat();return!g||g&&!r.test(g)?h:(g.replace(s,function(f){var g=new RegExp(o).exec(f).filter(function(a){return""!==a&&null!=a}),i=g[1],j=g.slice(2).map(parseFloat);switch(i){case"translate":e(h,j);break;case"rotate":a(h,j);break;case"scale":b(h,j);break;case"skewX":c(h,j);break;case"skewY":d(h,j);break;case"matrix":h=j}}),h)}}(),o.parseSVGDocument=function(){function a(a,b){for(;a&&(a=a.parentNode);)if(b.test(a.nodeName))return!0;return!1}var b=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,c="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",d=new RegExp("^\\s*("+c+"+)\\s*,?\\s*("+c+"+)\\s*,?\\s*("+c+"+)\\s*,?\\s*("+c+"+)\\s*$");return function(c,e,f){if(c){var g=new Date,i=o.util.toArray(c.getElementsByTagName("*"));if(0===i.length){i=c.selectNodes("//*[name(.)!='svg']");for(var j=[],k=0,l=i.length;l>k;k++)j[k]=i[k];i=j}var m=i.filter(function(c){return b.test(c.tagName)&&!a(c,/^(?:pattern|defs)$/)});if(m&&(!m||m.length)){var n,p,q=c.getAttribute("viewBox"),s=c.getAttribute("width"),t=c.getAttribute("height"),u=null,v=null;q&&(q=q.match(d))&&(n=parseInt(q[1],10),p=parseInt(q[2],10),u=parseInt(q[3],10),v=parseInt(q[4],10)),u=s?parseFloat(s):u,v=t?parseFloat(t):v;var w={width:u,height:v};o.gradientDefs=o.getGradientDefs(c),o.cssRules=h(c),o.parseElements(m,function(a){o.documentParsingTime=new Date-g,e&&e(a,w)},r(w),f)}}}}();var t={has:function(a,b){b(!1)},get:function(){},set:function(){}};p(o,{parseAttributes:c,parseElements:g,parseStyleAttribute:e,parsePointsAttribute:d,getCSSRules:h,loadSVGFromURL:j,loadSVGFromString:l,createSVGFontFacesMarkup:m,createSVGRefElementsMarkup:n})}("undefined"!=typeof exports?exports:this),function(){function a(a){var b,c,d=a.getAttribute("style"),e=a.getAttribute("offset");if(e=parseFloat(e)/(/%$/.test(e)?100:1),d){var f=d.split(/\s*;\s*/);""===f[f.length-1]&&f.pop();for(var g=f.length;g--;){var h=f[g].split(/\s*:\s*/),i=h[0].trim(),j=h[1].trim();"stop-color"===i?b=j:"stop-opacity"===i&&(c=j)}}return b||(b=a.getAttribute("stop-color")),c||(c=a.getAttribute("stop-opacity")),b=new fabric.Color(b).toRgb(),{offset:e,color:b,opacity:c}}function b(a,b){for(var c in b){if("string"==typeof b[c]&&/^\d+%$/.test(b[c])){var d=parseFloat(b[c],10);"x1"===c||"x2"===c||"r2"===c?b[c]=fabric.util.toFixed(a.width*d/100,2):("y1"===c||"y2"===c)&&(b[c]=fabric.util.toFixed(a.height*d/100,2))}"x1"===c||"x2"===c?b[c]-=fabric.util.toFixed(a.width/2,2):("y1"===c||"y2"===c)&&(b[c]-=fabric.util.toFixed(a.height/2,2))}}function c(a,b){for(var c in b)"x1"===c||"x2"===c?b[c]+=fabric.util.toFixed(a.width/2,2):("y1"===c||"y2"===c)&&(b[c]+=fabric.util.toFixed(a.height/2,2)),"x1"===c||"x2"===c||"r2"===c?b[c]=fabric.util.toFixed(b[c]/a.width*100,2)+"%":("y1"===c||"y2"===c)&&(b[c]=fabric.util.toFixed(b[c]/a.height*100,2)+"%")}function d(a){var b,c,d=a.getElementsByTagName("linearGradient"),e=a.getElementsByTagName("radialGradient"),f={};for(c=d.length;c--;)b=d[c],f[b.getAttribute("id")]=b;for(c=e.length;c--;)b=e[c],f[b.getAttribute("id")]=b;return f}fabric.Gradient=fabric.util.createClass({initialize:function(a){a||(a={});var b={};this.id=fabric.Object.__uid++,this.type=a.type||"linear",b={x1:a.coords?a.coords.x1:0,y1:a.coords?a.coords.y1:0,x2:a.coords?a.coords.x2:0,y2:a.coords?a.coords.y2:0},"radial"===this.type&&(b.r1=a.coords.r1||0,b.r2=a.coords.r2||0),this.coords=b,this.gradientUnits=a.gradientUnits||"objectBoundingBox",this.colorStops=fabric.util.object.clone(a.colorStops)},addColorStop:function(a){for(var b in a){var c=new fabric.Color(a[b]);this.colorStops.push({offset:b,color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toLive:function(a){var b;if(this.type){"linear"===this.type?b=a.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2||a.canvas.width,this.coords.y2):"radial"===this.type&&(b=a.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2));for(var c=0;c<this.colorStops.length;c++){var d=this.colorStops[c].color,e=this.colorStops[c].opacity,f=this.colorStops[c].offset;e&&(d=new fabric.Color(d).setAlpha(e).toRgba()),b.addColorStop(parseFloat(f),d)}return b}},toSVG:function(a,b){var d,e=fabric.util.object.clone(this.coords);this.colorStops.sort(function(a,b){return a.offset-b.offset}),b&&"userSpaceOnUse"===this.gradientUnits?(e.x1+=a.width/2,e.y1+=a.height/2,e.x2+=a.width/2,e.y2+=a.height/2):"objectBoundingBox"===this.gradientUnits&&c(a,e),"linear"===this.type?d=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',e.x1,'" y1="',e.y1,'" x2="',e.x2,'" y2="',e.y2,'">']:"radial"===this.type&&(d=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',e.x2,'" cy="',e.y2,'" r="',e.r2,'" fx="',e.x1,'" fy="',e.y1,'">']);for(var f=0;f<this.colorStops.length;f++)d.push("<stop ",'offset="',100*this.colorStops[f].offset+"%",'" style="stop-color:',this.colorStops[f].color,this.colorStops[f].opacity?";stop-opacity: "+this.colorStops[f].opacity:";",'"/>');return d.push("linear"===this.type?"</linearGradient>":"</radialGradient>"),d.join("")}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(c,d){var e=c.getElementsByTagName("stop"),f="linearGradient"===c.nodeName?"linear":"radial",g=c.getAttribute("gradientUnits")||"objectBoundingBox",h=[],i={};"linear"===f?i={x1:c.getAttribute("x1")||0,y1:c.getAttribute("y1")||0,x2:c.getAttribute("x2")||"100%",y2:c.getAttribute("y2")||0}:"radial"===f&&(i={x1:c.getAttribute("fx")||c.getAttribute("cx")||"50%",y1:c.getAttribute("fy")||c.getAttribute("cy")||"50%",r1:0,x2:c.getAttribute("cx")||"50%",y2:c.getAttribute("cy")||"50%",r2:c.getAttribute("r")||"50%"});for(var j=e.length;j--;)h.push(a(e[j]));return b(d,i),new fabric.Gradient({type:f,coords:i,gradientUnits:g,colorStops:h})},forObject:function(a,c){return c||(c={}),b(a,c),new fabric.Gradient(c)}}),fabric.getGradientDefs=d}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",initialize:function(a){a||(a={}),a.source&&(this.source="string"==typeof a.source?new Function(a.source):a.source),a.repeat&&(this.repeat=a.repeat)},toObject:function(){var a;return"function"==typeof this.source?a=String(this.source).match(/function\s+\w*\s*\(.*\)\s+\{([\s\S]*)\}/)[1]:"string"==typeof this.source.src&&(a=this.source.src),{source:a,repeat:this.repeat}},toLive:function(a){var b="function"==typeof this.source?this.source():this.source;return a.createPattern(b,this.repeat)}}),fabric.Shadow=fabric.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,initialize:function(a){for(var b in a)this[b]=a[b]},toObject:function(){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(){}}),function(a){"use strict";function b(a,b){arguments.length>0&&this.init(a,b)}var c=a.fabric||(a.fabric={});return c.Point?void c.warn("fabric.Point is already defined"):(c.Point=b,void(b.prototype={constructor:b,init:function(a,b){this.x=a,this.y=b},add:function(a){return new b(this.x+a.x,this.y+a.y)},addEquals:function(a){return this.x+=a.x,this.y+=a.y,this},scalarAdd:function(a){return new b(this.x+a,this.y+a)},scalarAddEquals:function(a){return this.x+=a,this.y+=a,this},subtract:function(a){return new b(this.x-a.x,this.y-a.y)},subtractEquals:function(a){return this.x-=a.x,this.y-=a.y,this},scalarSubtract:function(a){return new b(this.x-a,this.y-a)},scalarSubtractEquals:function(a){return this.x-=a,this.y-=a,this},multiply:function(a){return new b(this.x*a,this.y*a)},multiplyEquals:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return new b(this.x/a,this.y/a)},divideEquals:function(a){return this.x/=a,this.y/=a,this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,c){return new b(this.x+(a.x-this.x)*c,this.y+(a.y-this.y)*c)},distanceFrom:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(a){return new b(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new b(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new b(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(a,b){this.x=a,this.y=b},setFromPoint:function(a){this.x=a.x,this.y=a.y},swap:function(a){var b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c}}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){arguments.length>0&&this.init(a)}var c=a.fabric||(a.fabric={});return c.Intersection?void c.warn("fabric.Intersection is already defined"):(c.Intersection=b,c.Intersection.prototype={init:function(a){this.status=a,this.points=[]},appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},c.Intersection.intersectLineLine=function(a,d,e,f){var g,h=(f.x-e.x)*(a.y-e.y)-(f.y-e.y)*(a.x-e.x),i=(d.x-a.x)*(a.y-e.y)-(d.y-a.y)*(a.x-e.x),j=(f.y-e.y)*(d.x-a.x)-(f.x-e.x)*(d.y-a.y);if(0!==j){var k=h/j,l=i/j;k>=0&&1>=k&&l>=0&&1>=l?(g=new b("Intersection"),g.points.push(new c.Point(a.x+k*(d.x-a.x),a.y+k*(d.y-a.y)))):g=new b("No Intersection")}else g=new b(0===h||0===i?"Coincident":"Parallel");return g},c.Intersection.intersectLinePolygon=function(a,c,d){for(var e=new b("No Intersection"),f=d.length,g=0;f>g;g++){var h=d[g],i=d[(g+1)%f],j=b.intersectLineLine(a,c,h,i);e.appendPoints(j.points)}return e.points.length>0&&(e.status="Intersection"),e},c.Intersection.intersectPolygonPolygon=function(a,c){for(var d=new b("No Intersection"),e=a.length,f=0;e>f;f++){var g=a[f],h=a[(f+1)%e],i=b.intersectLinePolygon(g,h,c);d.appendPoints(i.points)}return d.points.length>0&&(d.status="Intersection"),d},c.Intersection.intersectPolygonRectangle=function(a,d,e){var f=d.min(e),g=d.max(e),h=new c.Point(g.x,f.y),i=new c.Point(f.x,g.y),j=b.intersectLinePolygon(f,h,a),k=b.intersectLinePolygon(h,g,a),l=b.intersectLinePolygon(g,i,a),m=b.intersectLinePolygon(i,f,a),n=new b("No Intersection");return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n.points.length>0&&(n.status="Intersection"),n},void 0)}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}var c=a.fabric||(a.fabric={});return c.Color?void c.warn("fabric.Color is already defined."):(c.Color=b,c.Color.prototype={_tryParsingColor:function(a){var c;a in b.colorNameMap&&(a=b.colorNameMap[a]),c=b.sourceFromHex(a),c||(c=b.sourceFromRgb(a)),c&&this.setSource(c)},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHex:function(){var a=this.getSource(),b=a[0].toString(16);b=1===b.length?"0"+b:b;var c=a[1].toString(16);c=1===c.length?"0"+c:c;var d=a[2].toString(16);return d=1===d.length?"0"+d:d,b.toUpperCase()+c.toUpperCase()+d.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();return b[3]=a,this.setSource(b),this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10),c=a[3];return this.setSource([b,b,b,c]),this},toBlackWhite:function(a){var b=this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),d=b[3];return a=a||127,c=Number(c)<Number(a)?0:255,this.setSource([c,c,c,d]),this},overlayWith:function(a){a instanceof b||(a=new b(a));for(var c=[],d=this.getAlpha(),e=.5,f=this.getSource(),g=a.getSource(),h=0;3>h;h++)c.push(Math.round(f[h]*(1-e)+g[h]*e));return c[3]=d,this.setSource(c),this}},c.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/,c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},c.Color.sourceFromRgb=function(a){var c=a.match(b.reRGBa);return c?[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10),c[4]?parseFloat(c[4]):1]:void 0},c.Color.fromRgba=b.fromRgb,c.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},c.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),d=3===c.length,e=d?c.charAt(0)+c.charAt(0):c.substring(0,2),f=d?c.charAt(1)+c.charAt(1):c.substring(2,4),g=d?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(e,16),parseInt(f,16),parseInt(g,16),1]}},c.Color.fromSource=function(a){var c=new b;return c.setSource(a),c},void 0)}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var a=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,d=fabric.util.removeListener,e=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=function(a,b){b||(b={}),this._initStatic(a,b),fabric.StaticCanvas.activeInstance=this},a(fabric.StaticCanvas.prototype,fabric.Observable),a(fabric.StaticCanvas.prototype,{backgroundColor:"",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:!0,overlayImage:"",overlayImageLeft:0,overlayImageTop:0,includeDefaultValues:!0,stateful:!0,renderOnAddition:!0,clipTo:null,controlsAboveOverlay:!1,onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[],this._createLowerCanvas(a),this._initOptions(b),b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this)),b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this)),b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=b(this.lowerCanvasEl),this},setOverlayImage:function(a,b,c){return fabric.util.loadImage(a,function(a){this.overlayImage=a,c&&"overlayImageLeft"in c&&(this.overlayImageLeft=c.overlayImageLeft),c&&"overlayImageTop"in c&&(this.overlayImageTop=c.overlayImageTop),b&&b()},this),this},setBackgroundImage:function(a,b,c){return fabric.util.loadImage(a,function(a){this.backgroundImage=a,c&&"backgroundImageOpacity"in c&&(this.backgroundImageOpacity=c.backgroundImageOpacity),c&&"backgroundImageStretch"in c&&(this.backgroundImageStretch=c.backgroundImageStretch),b&&b()},this),this},setBackgroundColor:function(a,b){if(a.source){var c=this;fabric.util.loadImage(a.source,function(d){c.backgroundColor=new fabric.Pattern({source:d,repeat:a.repeat}),b&&b()})}else this.backgroundColor=a,b&&b();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");if(a.style||(a.style={}),!a)throw e;return this._initCanvasElement(a),a},_initCanvasElement:function(a){if(fabric.util.createCanvasElement(a),"undefined"==typeof a.getContext)throw e},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=parseInt(this.lowerCanvasEl.width,10)||0,this.height=parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px")},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a){return this._setDimension("width",a)},setHeight:function(a){return this._setDimension("height",a)},setDimensions:function(a){for(var b in a)this._setDimension(b,a[b]);return this},_setDimension:function(a,b){return this.lowerCanvasEl[a]=b,this.lowerCanvasEl.style[a]=b+"px",this.upperCanvasEl&&(this.upperCanvasEl[a]=b,this.upperCanvasEl.style[a]=b+"px"),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b),this.wrapperEl&&(this.wrapperEl.style[a]=b+"px"),this[a]=b,this.calcOffset(),this.renderAll(),this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b)if(this.controlsAboveOverlay){var c=b.hasBorders,d=b.hasControls;b.hasBorders=b.hasControls=!1,b.render(a),b.hasBorders=c,b.hasControls=d}else b.render(a)},add:function(){this._objects.push.apply(this._objects,arguments);for(var a=arguments.length;a--;)this._initObject(arguments[a]);return this.renderOnAddition&&this.renderAll(),this},_initObject:function(a){this.stateful&&a.setupState(),a.setCoords(),a.canvas=this,this.fire("object:added",{target:a}),a.fire("added")},insertAt:function(a,b,c){return c?this._objects[b]=a:this._objects.splice(b,0,a),this._initObject(a),this.renderOnAddition&&this.renderAll(),this},getObjects:function(){return this._objects},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(a){var b=this[a===!0&&this.interactive?"contextTop":"contextContainer"];this.contextTop&&this.selection&&this.clearContext(this.contextTop),a||this.clearContext(b),this.fire("before:render"),this.clipTo&&fabric.util.clipCanvas(this,b),this.backgroundColor&&(b.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(b):this.backgroundColor,b.fillRect(0,0,this.width,this.height)),"object"==typeof this.backgroundImage&&this._drawBackroundImage(b);for(var c=this.getActiveGroup(),d=0,e=this._objects.length;e>d;++d)(!c||c&&this._objects[d]&&!c.contains(this._objects[d]))&&this._draw(b,this._objects[d]);if(c){var f=[];this.forEachObject(function(a){c.contains(a)&&f.push(a)}),c._set("objects",f),this._draw(b,c)}return this.clipTo&&b.restore(),this.overlayImage&&b.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop),this.controlsAboveOverlay&&this.drawControls(b),this.fire("after:render"),this},_drawBackroundImage:function(a){a.save(),a.globalAlpha=this.backgroundImageOpacity,this.backgroundImageStretch?a.drawImage(this.backgroundImage,0,0,this.width,this.height):a.drawImage(this.backgroundImage,0,0),a.restore()},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a),this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();return b&&b.render(a),this.overlayImage&&a.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop),this.fire("after:render"),this
},drawControls:function(a){var b=this.getActiveGroup();if(b)a.save(),fabric.Group.prototype.transform.call(b,a),b.drawBorders(a).drawControls(a),a.restore();else for(var c=0,d=this._objects.length;d>c;++c)this._objects[c]&&this._objects[c].active&&(a.save(),fabric.Object.prototype.transform.call(this._objects[c],a),this._objects[c].drawBorders(a).drawControls(a),a.restore(),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[c])},toDataURL:function(a){a||(a={});var b=a.format||"png",c=a.quality||1,d=a.multiplier||1;return 1!==d?this.__toDataURLWithMultiplier(b,c,d):this.__toDataURL(b,c)},__toDataURL:function(a,b){this.renderAll(!0);var c=this.upperCanvasEl||this.lowerCanvasEl,d=fabric.StaticCanvas.supports("toDataURLWithQuality")?c.toDataURL("image/"+a,b):c.toDataURL("image/"+a);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),d},__toDataURLWithMultiplier:function(a,b,c){var d=this.getWidth(),e=this.getHeight(),f=d*c,g=e*c,h=this.getActiveObject(),i=this.getActiveGroup(),j=this.contextTop||this.contextContainer;this.setWidth(f).setHeight(g),j.scale(c,c),i?this._tempRemoveBordersControlsFromGroup(i):h&&this.deactivateAll&&this.deactivateAll(),this.width=d,this.height=e,this.renderAll(!0);var k=this.toDataURL(a,b);return j.scale(1/c,1/c),this.setWidth(d).setHeight(e),i?this._restoreBordersControlsOnGroup(i):h&&this.setActiveObject&&this.setActiveObject(h),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),k},toDataURLWithMultiplier:function(a,b,c){return this.toDataURL({format:a,multiplier:b,quality:c})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls,a.origBorderColor=a.borderColor,a.hasControls=!0,a.borderColor="rgba(0,0,0,0)",a.forEachObject(function(a){a.origBorderColor=a.borderColor,a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls,a.borderColor=a.origBorderColor,a.forEachObject(function(a){a.borderColor=a.origBorderColor,delete a.origBorderColor})},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){return a.set("left",this.getCenter().left),this.renderAll(),this},centerObjectV:function(a){return a.set("top",this.getCenter().top),this.renderAll(),this},centerObject:function(a){return this.centerObjectH(a).centerObjectV(a)},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var c={objects:this._objects.map(function(c){var d;this.includeDefaultValues||(d=c.includeDefaultValues,c.includeDefaultValues=!1);var e=c[a](b);return this.includeDefaultValues||(c.includeDefaultValues=d),e},this),background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.backgroundImage&&(c.backgroundImage=this.backgroundImage.src,c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch),this.overlayImage&&(c.overlayImage=this.overlayImage.src,c.overlayImageLeft=this.overlayImageLeft,c.overlayImageTop=this.overlayImageTop),fabric.util.populateWithProperties(this,c,b),c},toSVG:function(a){a||(a={});var b=[];a.suppressPreamble||b.push('<?xml version="1.0" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),b.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',this.width,'" ','height="',this.height,'" ',this.backgroundColor&&!this.backgroundColor.source?'style="background-color: '+this.backgroundColor+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>"),this.backgroundColor&&this.backgroundColor.source&&b.push('<rect x="0" y="0" ','width="',"repeat-y"===this.backgroundColor.repeat||"no-repeat"===this.backgroundColor.repeat?this.backgroundColor.source.width:this.width,'" height="',"repeat-x"===this.backgroundColor.repeat||"no-repeat"===this.backgroundColor.repeat?this.backgroundColor.source.height:this.height,'" fill="url(#backgroundColorPattern)"',"></rect>"),this.backgroundImage&&b.push('<image x="0" y="0" ','width="',this.backgroundImageStretch?this.width:this.backgroundImage.width,'" height="',this.backgroundImageStretch?this.height:this.backgroundImage.height,'" preserveAspectRatio="',this.backgroundImageStretch?"none":"defer",'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"></image>'),this.overlayImage&&b.push('<image x="',this.overlayImageLeft,'" y="',this.overlayImageTop,'" width="',this.overlayImage.width,'" height="',this.overlayImage.height,'" xlink:href="',this.overlayImage.src,'"></image>');for(var c=0,d=this.getObjects(),e=d.length;e>c;c++)b.push(d[c].toSVG());return b.push("</svg>"),b.join("")},isEmpty:function(){return 0===this._objects.length},remove:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this.discardActiveObject(),this.fire("selection:cleared"));var b=this._objects,c=b.indexOf(a);return-1!==c&&(b.splice(c,1),this.fire("object:removed",{target:a})),this.renderAll(),a},sendToBack:function(a){return c(this._objects,a),this._objects.unshift(a),this.renderAll()},bringToFront:function(a){return c(this._objects,a),this._objects.push(a),this.renderAll()},sendBackwards:function(a){var b=this._objects.indexOf(a),d=b;if(0!==b){for(var e=b-1;e>=0;--e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}c(this._objects,a),this._objects.splice(d,0,a)}return this.renderAll()},bringForward:function(a){var b=this.getObjects(),d=b.indexOf(a),e=d;if(d!==b.length-1){for(var f=d+1,g=this._objects.length;g>f;++f){var h=a.intersectsWithObject(b[f])||a.isContainedWithinObject(this._objects[f])||this._objects[f].isContainedWithinObject(a);if(h){e=f;break}}c(b,a),b.splice(e,0,a)}this.renderAll()},item:function(a){return this.getObjects()[a]},complexity:function(){return this.getObjects().reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)},forEachObject:function(a,b){for(var c=this.getObjects(),d=c.length;d--;)a.call(b,c[d],d,c);return this},dispose:function(){return this.clear(),this.interactive&&(d(this.upperCanvasEl,"mousedown",this._onMouseDown),d(this.upperCanvasEl,"mousemove",this._onMouseMove),d(fabric.window,"resize",this._onResize)),this},_resizeImageToFit:function(a){var b=a.width||a.offsetWidth,c=this.getWidth()/b;b&&(a.width=b*c)}}),fabric.StaticCanvas.prototype.toString=function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"},a(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(a){var b,c,d,e,f=a.getContext("2d"),g=f.getImageData(0,0,a.width,a.height),h=g.data,i=g.width,j=g.height;for(d=0;i>d;d++)for(e=0;j>e;e++)b=4*d*j+4*e,c=(h[b]+h[b+1]+h[b+2])/3,h[b]=c,h[b+1]=c,h[b+2]=c;f.putImageData(g,0,0)},supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case"getImageData":return"undefined"!=typeof c.getImageData;case"toDataURL":return"undefined"!=typeof b.toDataURL;case"toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.array.min,d=b.util.array.max;return b.FreeDrawing?void b.warn("fabric.FreeDrawing is already defined"):void(b.FreeDrawing=b.util.createClass({initialize:function(a){this.canvas=a,this._points=[]},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0;var a=this.canvas.contextTop;a.strokeStyle=this.canvas.freeDrawingColor,a.lineWidth=this.canvas.freeDrawingLineWidth,a.lineCap=a.lineJoin="round"},_prepareForDrawing:function(a){this.canvas._isCurrentlyDrawing=!0,this.canvas.discardActiveObject().renderAll();var c=new b.Point(a.x,a.y);this._reset(),this._addPoint(c),this.canvas.contextTop.moveTo(c.x,c.y)},_captureDrawingPath:function(a){var c=new b.Point(a.x,a.y);this._addPoint(c)},_render:function(){var a=this.canvas.contextTop;a.beginPath();var b=this._points[0],c=this._points[1];a.moveTo(b.x,b.y);for(var d=1,e=this._points.length;e>d;d++){var f=b.midPointFrom(c);a.quadraticCurveTo(b.x,b.y,f.x,f.y),b=this._points[d],c=this._points[d+1]}a.lineTo(b.x,b.y),a.stroke()},_getSVGPathData:function(){return this.box=this.getPathBoundingBox(this._points),this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(a){for(var b=[],e=[],f=a[0],g=a[1],h=f,i=1,j=a.length;j>i;i++){var k=f.midPointFrom(g);b.push(h.x),b.push(k.x),e.push(h.y),e.push(k.y),f=a[i],g=a[i+1],h=k}return b.push(f.x),e.push(f.y),{minx:c(b),miny:c(e),maxx:d(b),maxy:d(e)}},convertPointsToSVGPath:function(a,c,d,e){var f=[],g=new b.Point(a[0].x-c,a[0].y-e),h=new b.Point(a[1].x-c,a[1].y-e);f.push("M ",a[0].x-c," ",a[0].y-e," ");for(var i=1,j=a.length;j>i;i++){var k=g.midPointFrom(h);f.push("Q ",g.x," ",g.y," ",k.x," ",k.y," "),g=new b.Point(a[i].x-c,a[i].y-e),i+1<a.length&&(h=new b.Point(a[i+1].x-c,a[i+1].y-e))}return f.push("L ",g.x," ",g.y," "),f},createPath:function(a){var c=new b.Path(a);return c.fill=null,c.stroke=this.canvas.freeDrawingColor,c.strokeWidth=this.canvas.freeDrawingLineWidth,c},_finalizeAndAddPath:function(){this.canvas._isCurrentlyDrawing=!1;var a=this.canvas.contextTop;a.closePath();var b=this._getSVGPathData().join("");if("M 0 0 Q 0 0 0 0 L 0 0"===b)return void this.canvas.renderAll();var c=this.box.minx+(this.box.maxx-this.box.minx)/2,d=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(c,d,3,0,2*Math.PI,!1);var e=this.createPath(b);e.set({left:c,top:d}),this.canvas.add(e),e.setCoords(),this.canvas.contextTop&&this.canvas.clearContext(this.canvas.contextTop),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e})}}))}("undefined"!=typeof exports?exports:this),function(){function a(){}var b=fabric.util.object.extend,c=fabric.util.getPointer,d=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees,f=Math.atan2,g=Math.abs,h=Math.min,i=Math.max,j=.5;fabric.Canvas=function(a,b){b||(b={}),this._initStatic(a,b),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},a.prototype=fabric.StaticCanvas.prototype,fabric.Canvas.prototype=new a;var k={uniScaleTransform:!1,centerTransform:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,freeDrawingColor:"rgb(0, 0, 0)",freeDrawingLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this.freeDrawing=fabric.FreeDrawing&&new fabric.FreeDrawing(this),this._initWrapperElement(),this._createUpperCanvas(),this._initEvents(),this.calcOffset()},_resetCurrentTransform:function(a){var b=this._currentTransform;b.target.set("scaleX",b.original.scaleX),b.target.set("scaleY",b.original.scaleY),b.target.set("left",b.original.left),b.target.set("top",b.original.top),a.altKey||this.centerTransform?("center"!==b.originX&&(b.mouseXSign="right"===b.originX?-1:1),"center"!==b.originY&&(b.mouseYSign="bottom"===b.originY?-1:1),b.originX="center",b.originY="center"):(b.originX=b.original.originX,b.originY=b.original.originY)},containsPoint:function(a,b){var c=this.getPointer(a),d=this._normalizePointer(b,c),e=d.x,f=d.y,g=b._getImageLines(b.oCoords),h=b._findCrossPoints(e,f,g);return h&&h%2===1||b._findTargetCorner(a,this._offset)?!0:!1},_normalizePointer:function(a,b){var c=this.getActiveGroup(),d=b.x,e=b.y,f=c&&"group"!==a.type&&c.contains(a);return f&&(d-=c.left,e-=c.top),{x:d,y:e}},_isTargetTransparent:function(a,b,c){var d=this.contextCache,e=a.hasBorders,f=a.transparentCorners;a.hasBorders=a.transparentCorners=!1,this._draw(d,a),a.hasBorders=e,a.transparentCorners=f,this.targetFindTolerance>0&&(b>this.targetFindTolerance?b-=this.targetFindTolerance:b=0,c>this.targetFindTolerance?c-=this.targetFindTolerance:c=0);for(var g=!0,h=d.getImageData(b,c,2*this.targetFindTolerance||1,2*this.targetFindTolerance||1),i=3;i<h.data.length;i+=4){var j=h.data[i];if(g=0>=j,g===!1)break}return h=null,this.clearContext(d),g},_shouldClearSelection:function(a){var b=this.findTarget(a),c=this.getActiveGroup();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey},_setupCurrentTransform:function(a,b){var e,f="drag",g=c(a,b.canvas.upperCanvasEl);e=b._findTargetCorner(a,this._offset),e&&(f="ml"===e||"mr"===e?"scaleX":"mt"===e||"mb"===e?"scaleY":"mtr"===e?"rotate":"scale");var h="center",i="center";"ml"===e||"tl"===e||"bl"===e?h="right":("mr"===e||"tr"===e||"br"===e)&&(h="left"),"tl"===e||"mt"===e||"tr"===e?i="bottom":("bl"===e||"mb"===e||"br"===e)&&(i="top"),"mtr"===e&&(h="center",i="center"),this._currentTransform={target:b,action:f,scaleX:b.scaleX,scaleY:b.scaleY,offsetX:g.x-b.left,offsetY:g.y-b.top,originX:h,originY:i,ex:g.x,ey:g.y,left:b.left,top:b.top,theta:d(b.angle),width:b.width*b.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:b.left,top:b.top,scaleX:b.scaleX,scaleY:b.scaleY,originX:h,originY:i},this._resetCurrentTransform(a)},_shouldHandleGroupLogic:function(a,b){var c=this.getActiveObject();return a.shiftKey&&(this.getActiveGroup()||c&&c!==b)&&this.selection},_handleGroupLogic:function(a,b){if(b!==this.getActiveGroup()||(b=this.findTarget(a,!0),b&&!b.isType("group"))){var c=this.getActiveGroup();if(c)c.contains(b)?(c.removeWithUpdate(b),this._resetObjectTransform(c),b.setActive(!1),1===c.size()&&this.discardActiveGroup()):(c.addWithUpdate(b),this._resetObjectTransform(c)),this.fire("selection:created",{target:c,e:a}),c.setActive(!0);else{if(this._activeObject&&b!==this._activeObject){var d=new fabric.Group([this._activeObject,b]);this.setActiveGroup(d),c=this.getActiveGroup()}b.setActive(!0)}c&&c.saveCoords()}},_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX),c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_scaleObject:function(a,b,c){var d=this._currentTransform,e=this._offset,f=d.target,g=f.get("lockScalingX"),h=f.get("lockScalingY");if(!g||!h){var i=f.translateToOriginPoint(f.getCenterPoint(),d.originX,d.originY),j=f.toLocalPoint(new fabric.Point(a-e.left,b-e.top),d.originX,d.originY);"right"===d.originX?j.x*=-1:"center"===d.originX&&(j.x*=2*d.mouseXSign,j.x<0&&(d.mouseXSign=-d.mouseXSign)),"bottom"===d.originY?j.y*=-1:"center"===d.originY&&(j.y*=2*d.mouseYSign,j.y<0&&(d.mouseYSign=-d.mouseYSign));var k=f.scaleX,l=f.scaleY;if("equally"!==c||g||h)c?"x"!==c||f.get("lockUniScaling")?"y"===c&&!f.get("lockUniScaling")&&(l=j.y/(f.height+f.padding),h||f.set("scaleY",l)):(k=j.x/(f.width+f.padding),g||f.set("scaleX",k)):(k=j.x/(f.width+f.padding),l=j.y/(f.height+f.padding),g||f.set("scaleX",k),h||f.set("scaleY",l));else{var m=j.y+j.x,n=f.height*d.original.scaleY+f.width*d.original.scaleX+2*f.padding-2*f.strokeWidth+1;k=d.original.scaleX*m/n,l=d.original.scaleY*m/n,f.set("scaleX",k),f.set("scaleY",l)}0>k&&("left"===d.originX?d.originX="right":"right"===d.originX&&(d.originX="left")),0>l&&("top"===d.originY?d.originY="bottom":"bottom"===d.originY&&(d.originY="top")),f.setPositionByOrigin(i,d.originX,d.originY)}},_rotateObject:function(a,b){var c=this._currentTransform,d=this._offset;if(!c.target.get("lockRotation")){var g=f(c.ey-c.top-d.top,c.ex-c.left-d.left),h=f(b-c.top-d.top,a-c.left-d.left);c.target.angle=e(h-g+c.theta)}},_setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,b=this._groupSelector,c=b.left,d=b.top,e=g(c),f=g(d);if(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(c>0?0:-c),b.ey-(d>0?0:-d),e,f),a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1){var h=b.ex+j-(c>0?0:e),i=b.ey+j-(d>0?0:f);a.beginPath(),fabric.util.drawDashedLine(a,h,i,h+e,i,this.selectionDashArray),fabric.util.drawDashedLine(a,h,i+f-1,h+e,i+f-1,this.selectionDashArray),fabric.util.drawDashedLine(a,h,i,h,i+f,this.selectionDashArray),fabric.util.drawDashedLine(a,h+e-1,i,h+e-1,i+f,this.selectionDashArray),a.closePath(),a.stroke()}else a.strokeRect(b.ex+j-(c>0?0:e),b.ey+j-(d>0?0:f),e,f)},_findSelectedObjects:function(a){for(var b,c=[],d=this._groupSelector.ex,e=this._groupSelector.ey,f=d+this._groupSelector.left,g=e+this._groupSelector.top,j=new fabric.Point(h(d,f),h(e,g)),k=new fabric.Point(i(d,f),i(e,g)),l=0,m=this._objects.length;m>l;++l)b=this._objects[l],b&&(b.intersectsWithRect(j,k)||b.isContainedWithinRect(j,k))&&this.selection&&b.selectable&&(b.setActive(!0),c.push(b));1===c.length?this.setActiveObject(c[0],a):c.length>1&&(c=new fabric.Group(c),this.setActiveGroup(c),c.saveCoords(),this.fire("selection:created",{target:c})),this.renderAll()},findTarget:function(a,b){var c,d=this.getPointer(a);if(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(a,this._offset))return c=this.lastRenderedObjectWithControlsAboveOverlay;var e=this.getActiveGroup();if(e&&!b&&this.containsPoint(a,e))return c=e;for(var f=[],g=this._objects.length;g--;)if(this._objects[g]&&this.containsPoint(a,this._objects[g])){if(!this.perPixelTargetFind&&!this._objects[g].perPixelTargetFind){c=this._objects[g],this.relatedTarget=c;break}f[f.length]=this._objects[g]}for(var h=0,i=f.length;i>h;h++){d=this.getPointer(a);var j=this._isTargetTransparent(f[h],d.x,d.y);if(!j){c=f[h],this.relatedTarget=c;break}}return c&&c.selectable?c:void 0},getPointer:function(a){var b=c(a,this.upperCanvasEl);return{x:b.x-this._offset.left,y:b.y-this._offset.top}},_createUpperCanvas:function(){this.upperCanvasEl=this._createCanvasElement(),this.upperCanvasEl.className="upper-canvas",this.wrapperEl.appendChild(this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0}),a.width=b,a.height=c,fabric.util.makeElementUnselectable(a)},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(a,b){return this._activeObject&&this._activeObject.setActive(!1),this._activeObject=a,a.setActive(!0),this.renderAll(),this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}),this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){return this._activeObject&&this._activeObject.setActive(!1),this._activeObject=null,this},setActiveGroup:function(a){return this._activeGroup=a,a&&(a.canvas=this,a.setActive(!0)),this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var a=this.getActiveGroup();return a&&a.destroy(),this.setActiveGroup(null)},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;c>b;b++)a[b].setActive(!1);return this.discardActiveGroup(),this.discardActiveObject(),this},deactivateAllWithDispatch:function(){var a=this.getActiveGroup()||this.getActiveObject();return a&&this.fire("before:selection:cleared",{target:a}),this.deactivateAll(),a&&this.fire("selection:cleared"),this}};fabric.Canvas.prototype.toString=fabric.StaticCanvas.prototype.toString,b(fabric.Canvas.prototype,k);for(var l in fabric.StaticCanvas)"prototype"!==l&&(fabric.Canvas[l]=fabric.StaticCanvas[l]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var a={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"},b=fabric.util.addListener,c=fabric.util.removeListener,d=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEvents:function(){var a=this;this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),b(fabric.window,"resize",this._onResize),fabric.isTouchSupported?(b(this.upperCanvasEl,"touchstart",this._onMouseDown),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof Event&&"add"in Event&&Event.add(this.upperCanvasEl,"gesture",function(b,c){a.__onTransformGesture(b,c)})):(b(this.upperCanvasEl,"mousedown",this._onMouseDown),b(this.upperCanvasEl,"mousemove",this._onMouseMove))},_onMouseDown:function(a){this.__onMouseDown(a),!fabric.isTouchSupported&&b(fabric.document,"mouseup",this._onMouseUp),fabric.isTouchSupported&&b(fabric.document,"touchend",this._onMouseUp),!fabric.isTouchSupported&&b(fabric.document,"mousemove",this._onMouseMove),fabric.isTouchSupported&&b(fabric.document,"touchmove",this._onMouseMove),!fabric.isTouchSupported&&c(this.upperCanvasEl,"mousemove",this._onMouseMove),fabric.isTouchSupported&&c(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(a){this.__onMouseUp(a),!fabric.isTouchSupported&&c(fabric.document,"mouseup",this._onMouseUp),fabric.isTouchSupported&&c(fabric.document,"touchend",this._onMouseUp),!fabric.isTouchSupported&&c(fabric.document,"mousemove",this._onMouseMove),fabric.isTouchSupported&&c(fabric.document,"touchmove",this._onMouseMove),!fabric.isTouchSupported&&b(this.upperCanvasEl,"mousemove",this._onMouseMove),fabric.isTouchSupported&&b(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(a){a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)return this.freeDrawing._finalizeAndAddPath(),void this.fire("mouse:up",{e:a});if(this._currentTransform){var c=this._currentTransform;b=c.target,b._scaling&&(b._scaling=!1);for(var d=this._objects.length;d--;)this._objects[d].setCoords();b.isMoving=!1,this.stateful&&b.hasStateChanged()&&(this.fire("object:modified",{target:b}),b.fire("modified")),this._previousOriginX&&(this._currentTransform.target.adjustPosition(this._previousOriginX),this._previousOriginX=null)}this._currentTransform=null,this._groupSelector&&this._findSelectedObjects(a);var e=this.getActiveGroup();e&&(e.setObjectsCoords(),e.set("isMoving",!1),this._setCursor(this.defaultCursor)),this._groupSelector=null,this.renderAll(),this._setCursorFromEvent(a,b),this._setCursor("");var f=this;setTimeout(function(){f._setCursorFromEvent(a,b)},50),this.fire("mouse:up",{target:b,e:a}),b&&b.fire("mouseup",{e:a})},__onMouseDown:function(a){var b,c="which"in a?1===a.which:1===a.button;if(c||fabric.isTouchSupported){if(this.isDrawingMode)return b=this.getPointer(a),this.freeDrawing._prepareForDrawing(b),this.freeDrawing._captureDrawingPath(b),this.fire("mouse:down",{e:a}),void 0;if(!this._currentTransform){var d,e=this.findTarget(a);b=this.getPointer(a),this._shouldClearSelection(a)?(this._groupSelector={ex:b.x,ey:b.y,top:0,left:0},this.deactivateAllWithDispatch()):(this.stateful&&e.saveState(),(d=e._findTargetCorner(a,this._offset))&&this.onBeforeScaleRotate(e),this._shouldHandleGroupLogic(a,e)?(this._handleGroupLogic(a,e),e=this.getActiveGroup()):(e!==this.getActiveGroup()&&this.deactivateAll(),this.setActiveObject(e,a)),this._setupCurrentTransform(a,e)),this.renderAll(),this.fire("mouse:down",{target:e,e:a}),e&&e.fire("mousedown",{e:a}),"mtr"===d&&(this._previousOriginX=this._currentTransform.target.originX,this._currentTransform.target.adjustPosition("center"),this._currentTransform.left=this._currentTransform.target.left,this._currentTransform.top=this._currentTransform.target.top)}}},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)return this._isCurrentlyDrawing&&(c=this.getPointer(a),this.freeDrawing._captureDrawingPath(c),this.clearContext(this.contextTop),this.freeDrawing._render(this.contextTop)),this.upperCanvasEl.style.cursor=this.freeDrawingCursor,this.fire("mouse:move",{e:a}),void 0;var e=this._groupSelector;if(null!==e)c=d(a,this.upperCanvasEl),e.left=c.x-this._offset.left-e.ex,e.top=c.y-this._offset.top-e.ey,this.renderTop();else if(this._currentTransform){c=d(a,this.upperCanvasEl);var f=c.x,g=c.y;this._currentTransform.target.isMoving=!0;var h=this._currentTransform,i=!1;("scale"===h.action||"scaleX"===h.action||"scaleY"===h.action)&&(a.altKey&&("center"!==h.originX||"center"!==h.originY)||!a.altKey&&"center"===h.originX&&"center"===h.originY)&&(this._resetCurrentTransform(a),i=!0),"rotate"===this._currentTransform.action?(this._rotateObject(f,g),this.fire("object:rotating",{target:this._currentTransform.target,e:a}),this._currentTransform.target.fire("rotating")):"scale"===this._currentTransform.action?(a.shiftKey||this.uniScaleTransform?(this._currentTransform.currentAction="scale",this._scaleObject(f,g)):(!i&&"scale"===h.currentAction&&this._resetCurrentTransform(a),this._currentTransform.currentAction="scaleEqually",this._scaleObject(f,g,"equally")),this.fire("object:scaling",{target:this._currentTransform.target,e:a})):"scaleX"===this._currentTransform.action?(this._scaleObject(f,g,"x"),this.fire("object:scaling",{target:this._currentTransform.target,e:a}),this._currentTransform.target.fire("scaling",{e:a})):"scaleY"===this._currentTransform.action?(this._scaleObject(f,g,"y"),this.fire("object:scaling",{target:this._currentTransform.target,e:a}),this._currentTransform.target.fire("scaling",{e:a})):(this._translateObject(f,g),this.fire("object:moving",{target:this._currentTransform.target,e:a}),this._setCursor(this.moveCursor),this._currentTransform.target.fire("moving",{e:a})),this.renderAll()}else{var j=this.upperCanvasEl.style;if(b=this.findTarget(a))this._setCursorFromEvent(a,b);else{for(var k=this._objects.length;k--;)this._objects[k]&&!this._objects[k].active&&this._objects[k].setActive(!1);j.cursor=this.defaultCursor}}this.fire("mouse:move",{target:b,e:a}),b&&b.fire("mousemove",{e:a})},_setCursorFromEvent:function(b,c){var d=this.upperCanvasEl.style;if(!c)return d.cursor=this.defaultCursor,!1;var e=this.getActiveGroup(),f=c._findTargetCorner&&(!e||!e.contains(c))&&c._findTargetCorner(b,this._offset);if(f)if(f in a)d.cursor=a[f];else{if("mtr"!==f||!c.hasRotatingPoint)return d.cursor=this.defaultCursor,!1;d.cursor=this.rotationCursor}else d.cursor=this.hoverCursor;return!0}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){a.set("left",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxCenterObjectV:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){a.set("top",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxRemove:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){a.setActive(!1)},onChange:function(b){a.set("opacity",b),f.renderAll(),e()},onComplete:function(){f.remove(a),d()}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b){if(a){var c="string"==typeof a?JSON.parse(a):a;if(c&&(!c||c.objects)){this.clear();var d=this;this._enlivenDatalessObjects(c.objects,function(){d._setBgOverlayImages(c,b)})}}},_enlivenDatalessObjects:function(a,b){function c(a,c){e.insertAt(a,c,!0),a.setCoords(),++f===g&&b&&b()}function d(a,b){var d=a.paths?"paths":"path",e=a[d];if(delete a[d],"string"!=typeof e)if("image"===a.type||"group"===a.type)fabric[fabric.util.string.capitalize(a.type)].fromObject(a,function(a){c(a,b)});else{var f=fabric[fabric.util.string.camelize(fabric.util.string.capitalize(a.type))];if(!f||!f.fromObject)return;e&&(a[d]=e),c(f.fromObject(a),b)}else if("image"===a.type)fabric.util.loadImage(e,function(d){var f=new fabric.Image(d);f.setSourcePath(e),fabric.util.object.extend(f,a),f.setAngle(a.angle),c(f,b)});else if("text"===a.type)if(a.useNative)c(fabric.Text.fromObject(a),b);else{a.path=e;var g=fabric.Text.fromObject(a),h=function(){"[object Opera]"===Object.prototype.toString.call(fabric.window.opera)?setTimeout(function(){c(g,b)},500):c(g,b)};fabric.util.getScript(e,h)}else fabric.loadSVGFromURL(e,function(d){var f=fabric.util.groupSVGElements(d,a,e);f instanceof fabric.PathGroup||(fabric.util.object.extend(f,a),"undefined"!=typeof a.angle&&f.setAngle(a.angle)),c(f,b)})}var e=this,f=0,g=a.length;0===g&&b&&b();try{a.forEach(d,this)}catch(h){fabric.log(h)}},loadFromJSON:function(a,b){if(a){var c="string"==typeof a?JSON.parse(a):a,d=this;return this._enlivenObjects(c.objects,function(){d._setBgOverlayImages(c,b)}),this}},_setBgOverlayImages:function(a,b){var c,d,e,f=this;a.backgroundImage?this.setBackgroundImage(a.backgroundImage,function(){f.backgroundImageOpacity=a.backgroundImageOpacity,f.backgroundImageStretch=a.backgroundImageStretch,f.renderAll(),d=!0,b&&e&&c&&b()}):d=!0,a.overlayImage?this.setOverlayImage(a.overlayImage,function(){f.overlayImageLeft=a.overlayImageLeft||0,f.overlayImageTop=a.overlayImageTop||0,f.renderAll(),e=!0,b&&d&&c&&b()}):e=!0,a.background?this.setBackgroundColor(a.background,function(){f.renderAll(),c=!0,b&&e&&d&&b()}):c=!0,!a.backgroundImage&&!a.overlayImage&&!a.background&&b&&b()},_enlivenObjects:function(a,b){var c=this;fabric.util.enlivenObjects(a,function(a){a.forEach(function(a,b){c.insertAt(a,b,!0)}),b&&b()})},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,b,c){this.clone(function(d){c(d.toDataURLWithMultiplier(a,b))})},clone:function(a){var b=JSON.stringify(this);this.cloneWithoutData(function(c){c.loadFromJSON(b,function(){a&&a(c)})})},cloneWithoutData:function(a){var b=fabric.document.createElement("canvas");b.width=this.getWidth(),b.height=this.getHeight();var c=new fabric.Canvas(b);c.clipTo=this.clipTo,this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),a&&a(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):a&&a(c)}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.toFixed,e=b.util.string.capitalize,f=b.util.degreesToRadians;if(!b.Object){var g=a.Image;try{var h="undefined"!=typeof require&&require("canvas").Image;
h&&(g=h)}catch(i){b.log(i)}b.Object=b.util.createClass({type:"object",originX:"center",originY:"center",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,strokeDashArray:null,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,stateProperties:"top left width height scaleX scaleY flipX flipY angle opacity cornerSize fill overlayFill originX originY stroke strokeWidth strokeDashArray fillRule borderScaleFactor transformMatrix selectable shadow visible".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){a.fill&&a.fill.colorStops&&!(a.fill instanceof b.Gradient)&&this.set("fill",new b.Gradient(a.fill))},_initPattern:function(a){a.fill&&a.fill.source&&!(a.fill instanceof b.Pattern)&&this.set("fill",new b.Pattern(a.fill)),a.stroke&&a.stroke.source&&!(a.stroke instanceof b.Pattern)&&this.set("stroke",new b.Pattern(a.stroke))},_initShadow:function(a){a.shadow&&!(a.shadow instanceof b.Shadow)&&this.setShadow(a.shadow)},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a),this._initPattern(a),this._initShadow(a)},transform:function(a){a.globalAlpha=this.opacity;var b=this.getCenterPoint();a.translate(b.x,b.y),a.rotate(f(this.angle)),a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var c=b.Object.NUM_FRACTION_DIGITS,e={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,c),top:d(this.top,c),width:d(this.width,c),height:d(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,overlayFill:this.overlayFill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:this.strokeWidth,strokeDashArray:this.strokeDashArray,scaleX:d(this.scaleX,c),scaleY:d(this.scaleY,c),angle:d(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,c),selectable:this.selectable,hasControls:this.hasControls,hasBorders:this.hasBorders,hasRotatingPoint:this.hasRotatingPoint,transparentCorners:this.transparentCorners,perPixelTargetFind:this.perPixelTargetFind,shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible};return this.includeDefaultValues||(e=this._removeDefaultValues(e)),b.util.populateWithProperties(this,e,a),e},toDatalessObject:function(a){return this.toObject(a)},getSvgStyles:function(){return["stroke: ",this.stroke?this.stroke:"none","; ","stroke-width: ",this.strokeWidth?this.strokeWidth:"0","; ","stroke-dasharray: ",this.strokeDashArray?this.strokeDashArray.join(" "):"; ","fill: ",this.fill?this.fill&&this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none","; ","opacity: ",this.opacity?this.opacity:"1",";",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){var a=this.getAngle(),c=this.getCenterPoint(),e=b.Object.NUM_FRACTION_DIGITS,f="translate("+d(c.x,e)+" "+d(c.y,e)+")",g=0!==a?" rotate("+d(a,e)+")":"",h=1===this.scaleX&&1===this.scaleY?"":" scale("+d(this.scaleX,e)+" "+d(this.scaleY,e)+")",i=this.flipX?"matrix(-1 0 0 1 0 0) ":"",j=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[f,g,h,i,j].join("")},_removeDefaultValues:function(a){var c=b.Object.prototype.options;return c&&this.stateProperties.forEach(function(b){a[b]===c[b]&&delete a[b]}),a},isActive:function(){return!!this.active},setActive:function(a){return this.active=!!a,this},toString:function(){return"#<fabric."+e(this.type)+">"},get:function(a){return this[a]},set:function(a,b){if("object"==typeof a)for(var c in a)this._set(c,a[c]);else"function"==typeof b?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(a,b){var c="scaleX"===a||"scaleY"===a;return c&&(b=this._constrainScale(b)),"scaleX"===a&&0>b?(this.flipX=!this.flipX,b*=-1):"scaleY"===a&&0>b?(this.flipY=!this.flipY,b*=-1):("width"===a||"height"===a)&&(this.minScaleLimit=d(Math.min(.1,1/Math.max(this.width,this.height)),2)),this[a]=b,this},toggle:function(a){var b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this},setSourcePath:function(a){return this.sourcePath=a,this},render:function(a,c){if(0!==this.width&&0!==this.height&&this.visible){a.save();var d=this.transformMatrix;d&&!this.group&&a.setTransform(d[0],d[1],d[2],d[3],d[4],d[5]),c||this.transform(a),(this.stroke||this.strokeDashArray)&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.stroke&&this.stroke.toLive?this.stroke.toLive(a):this.stroke),this.overlayFill?a.fillStyle=this.overlayFill:this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill),d&&this.group&&(a.translate(-this.group.width/2,-this.group.height/2),a.transform(d[0],d[1],d[2],d[3],d[4],d[5])),this._setShadow(a),this.clipTo&&b.util.clipContext(this,a),this._render(a,c),this.clipTo&&a.restore(),this._removeShadow(a),this.active&&!c&&(this.drawBorders(a),this.drawControls(a)),a.restore()}},_setShadow:function(a){this.shadow&&(a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(a){a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},clone:function(a,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),a):new b.Object(this.toObject(c))},cloneAsImage:function(a){if(b.Image){var c=new g;c.onload=function(){a&&a(new b.Image(c),d),c=c.onload=null};var d={angle:this.getAngle(),flipX:this.getFlipX(),flipY:this.getFlipY()};this.set({angle:0,flipX:!1,flipY:!1}),this.toDataURL(function(a){c.src=a})}return this},toDataURL:function(a){function c(b){b.left=d.width/2,b.top=d.height/2,b.setActive(!1),e.add(b);var c=e.toDataURL();e.dispose(),e=b=null,a&&a(c)}var d=b.util.createCanvasElement();d.width=this.getBoundingRectWidth(),d.height=this.getBoundingRectHeight(),b.util.wrapElement(d,"div");var e=new b.Canvas(d);e.backgroundColor="transparent",e.renderAll(),this.constructor.async?this.clone(c):c(this.clone())},hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(a){return this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this),a&&a.stateProperties&&a.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this),this},setupState:function(){this.originalState={},this.saveState()},isType:function(a){return this.type===a},toGrayscale:function(){var a=this.get("fill");return a&&this.set("overlayFill",new b.Color(a).toGrayscale().toRgb()),this},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var d={colorStops:[]};d.type=c.type||(c.r1||c.r2?"radial":"linear"),d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2},(c.r1||c.r2)&&(d.coords.r1=c.r1,d.coords.r2=c.r2);for(var e in c.colorStops){var f=new b.Color(c.colorStops[e]);d.colorStops.push({offset:e,color:f.toRgb(),opacity:f.getAlpha()})}this.set(a,b.Gradient.forObject(this,d))},setPatternFill:function(a){this.set("fill",new b.Pattern(a))},setShadow:function(a){this.set("shadow",new b.Shadow(a))},animate:function(){if(arguments[0]&&"object"==typeof arguments[0])for(var a in arguments[0])this._animate(a,arguments[0][a],arguments[1]);else this._animate.apply(this,arguments);return this},_animate:function(a,c,d){var e,f=this;c=c.toString(),d=d?b.util.object.clone(d):{},~a.indexOf(".")&&(e=a.split("."));var g=e?this.get(e[0])[e[1]]:this.get(a);"from"in d||(d.from=g),c=~c.indexOf("=")?g+parseFloat(c.replace("=","")):parseFloat(c),b.util.animate({startValue:d.from,endValue:c,byValue:d.by,easing:d.easing,duration:d.duration,onChange:function(b){e?f[e[0]][e[1]]=b:f.set(a,b),d.onChange&&d.onChange()},onComplete:function(){f.setCoords(),d.onComplete&&d.onComplete()}})},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){return this.canvas.sendToBack(this),this},bringToFront:function(){return this.canvas.bringToFront(this),this},sendBackwards:function(){return this.canvas.sendBackwards(this),this},bringForward:function(){return this.canvas.bringForward(this),this}}),b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,c(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object.__uid=0}}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(b,c,d){var e=b.x,f=b.y;return"left"===c?e=b.x+this.getWidth()/2:"right"===c&&(e=b.x-this.getWidth()/2),"top"===d?f=b.y+this.getHeight()/2:"bottom"===d&&(f=b.y-this.getHeight()/2),fabric.util.rotatePoint(new fabric.Point(e,f),b,a(this.angle))},translateToOriginPoint:function(b,c,d){var e=b.x,f=b.y;return"left"===c?e=b.x-this.getWidth()/2:"right"===c&&(e=b.x+this.getWidth()/2),"top"===d?f=b.y-this.getHeight()/2:"bottom"===d&&(f=b.y+this.getHeight()/2),fabric.util.rotatePoint(new fabric.Point(e,f),b,a(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new fabric.Point(this.left,this.top),this.originX,this.originY)},toLocalPoint:function(b,c,d){var e,f,g=this.getCenterPoint();return void 0!==c&&void 0!==d?(e="left"===c?g.x-this.getWidth()/2:"right"===c?g.x+this.getWidth()/2:g.x,f="top"===d?g.y-this.getHeight()/2:"bottom"===d?g.y+this.getHeight()/2:g.y):(e=this.left,f=this.top),fabric.util.rotatePoint(new fabric.Point(b.x,b.y),g,-a(this.angle)).subtractEquals(new fabric.Point(e,f))},setPositionByOrigin:function(a,b,c){var d=this.translateToCenterPoint(a,b,c),e=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",e.x),this.set("top",e.y)},adjustPosition:function(b){var c=a(this.angle),d=this.getWidth()/2,e=Math.cos(c)*d,f=Math.sin(c)*d,g=this.getWidth(),h=Math.cos(c)*g,i=Math.sin(c)*g;"center"===this.originX&&"left"===b||"right"===this.originX&&"center"===b?(this.left-=e,this.top-=f):"left"===this.originX&&"center"===b||"center"===this.originX&&"right"===b?(this.left+=e,this.top+=f):"left"===this.originX&&"right"===b?(this.left+=h,this.top+=i):"right"===this.originX&&"left"===b&&(this.left-=h,this.top-=i),this.setCoords(),this.originX=b}})}(),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{intersectsWithRect:function(a,b){var c=this.oCoords,d=new fabric.Point(c.tl.x,c.tl.y),e=new fabric.Point(c.tr.x,c.tr.y),f=new fabric.Point(c.bl.x,c.bl.y),g=new fabric.Point(c.br.x,c.br.y),h=fabric.Intersection.intersectPolygonRectangle([d,e,g,f],a,b);return"Intersection"===h.status},intersectsWithObject:function(a){function b(a){return{tl:new fabric.Point(a.tl.x,a.tl.y),tr:new fabric.Point(a.tr.x,a.tr.y),bl:new fabric.Point(a.bl.x,a.bl.y),br:new fabric.Point(a.br.x,a.br.y)}}var c=b(this.oCoords),d=b(a.oCoords),e=fabric.Intersection.intersectPolygonPolygon([c.tl,c.tr,c.br,c.bl],[d.tl,d.tr,d.br,d.bl]);return"Intersection"===e.status},isContainedWithinObject:function(a){return this.isContainedWithinRect(a.oCoords.tl,a.oCoords.br)},isContainedWithinRect:function(a,b){var c=this.oCoords,d=new fabric.Point(c.tl.x,c.tl.y),e=new fabric.Point(c.tr.x,c.tr.y),f=new fabric.Point(c.bl.x,c.bl.y);return d.x>a.x&&e.x<b.x&&d.y>a.y&&f.y<b.y},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],b=fabric.util.array.min(a),c=fabric.util.array.max(a),d=Math.abs(b-c),e=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],f=fabric.util.array.min(e),g=fabric.util.array.max(e),h=Math.abs(f-g);return{left:b,top:f,width:d,height:h}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){return a=this._constrainScale(a),0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1),this.scaleX=a,this.scaleY=a,this.setCoords(),this},scaleToWidth:function(a){var b=this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/b)},setCoords:function(){var b=this.strokeWidth>1?this.strokeWidth:0,c=this.padding,d=a(this.angle);this.currentWidth=(this.width+b)*this.scaleX+2*c,this.currentHeight=(this.height+b)*this.scaleY+2*c,this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var e=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),f=Math.atan(this.currentHeight/this.currentWidth),g=Math.cos(f+d)*e,h=Math.sin(f+d)*e,i=Math.sin(d),j=Math.cos(d),k=this.getCenterPoint(),l={x:k.x-g,y:k.y-h},m={x:l.x+this.currentWidth*j,y:l.y+this.currentWidth*i},n={x:m.x-this.currentHeight*i,y:m.y+this.currentHeight*j},o={x:l.x-this.currentHeight*i,y:l.y+this.currentHeight*j},p={x:l.x-this.currentHeight/2*i,y:l.y+this.currentHeight/2*j},q={x:l.x+this.currentWidth/2*j,y:l.y+this.currentWidth/2*i},r={x:m.x-this.currentHeight/2*i,y:m.y+this.currentHeight/2*j},s={x:o.x+this.currentWidth/2*j,y:o.y+this.currentWidth/2*i},t={x:l.x+this.currentWidth/2*j,y:l.y+this.currentWidth/2*i};return this.oCoords={tl:l,tr:m,br:n,bl:o,ml:p,mt:q,mr:r,mb:s,mtr:t},this._setCornerCoords(),this}})}(),function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(b,c){if(!this.hasControls||!this.active)return!1;var d,e,f=a(b,this.canvas.upperCanvasEl),g=f.x-c.left,h=f.y-c.top;for(var i in this.oCoords)if(("mtr"!==i||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==i&&"mr"!==i&&"mb"!==i&&"ml"!==i)&&(e=this._getImageLines(this.oCoords[i].corner,i),d=this._findCrossPoints(g,h,e),d%2===1&&0!==d))return this.__corner=i,i;return!1},_findCrossPoints:function(a,b,c){var d,e,f,g,h,i,j,k=0;for(var l in c)if(j=c[l],!(j.o.y<b&&j.d.y<b||j.o.y>=b&&j.d.y>=b||(j.o.x===j.d.x&&j.o.x>=a?(h=j.o.x,i=b):(d=0,e=(j.d.y-j.o.y)/(j.d.x-j.o.x),f=b-d*a,g=j.o.y-e*j.o.x,h=-(f-g)/(d-e),i=f+d*h),h>=a&&(k+=1),2!==k)))break;return k},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_setCornerCoords:function(){var a=this.oCoords,c=b(this.angle),d=b(45-this.angle),e=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,f=e*Math.cos(d),g=e*Math.sin(d),h=Math.sin(c),i=Math.cos(c);a.tl.corner={tl:{x:a.tl.x-g,y:a.tl.y-f},tr:{x:a.tl.x+f,y:a.tl.y-g},bl:{x:a.tl.x-f,y:a.tl.y+g},br:{x:a.tl.x+g,y:a.tl.y+f}},a.tr.corner={tl:{x:a.tr.x-g,y:a.tr.y-f},tr:{x:a.tr.x+f,y:a.tr.y-g},br:{x:a.tr.x+g,y:a.tr.y+f},bl:{x:a.tr.x-f,y:a.tr.y+g}},a.bl.corner={tl:{x:a.bl.x-g,y:a.bl.y-f},bl:{x:a.bl.x-f,y:a.bl.y+g},br:{x:a.bl.x+g,y:a.bl.y+f},tr:{x:a.bl.x+f,y:a.bl.y-g}},a.br.corner={tr:{x:a.br.x+f,y:a.br.y-g},bl:{x:a.br.x-f,y:a.br.y+g},br:{x:a.br.x+g,y:a.br.y+f},tl:{x:a.br.x-g,y:a.br.y-f}},a.ml.corner={tl:{x:a.ml.x-g,y:a.ml.y-f},tr:{x:a.ml.x+f,y:a.ml.y-g},bl:{x:a.ml.x-f,y:a.ml.y+g},br:{x:a.ml.x+g,y:a.ml.y+f}},a.mt.corner={tl:{x:a.mt.x-g,y:a.mt.y-f},tr:{x:a.mt.x+f,y:a.mt.y-g},bl:{x:a.mt.x-f,y:a.mt.y+g},br:{x:a.mt.x+g,y:a.mt.y+f}},a.mr.corner={tl:{x:a.mr.x-g,y:a.mr.y-f},tr:{x:a.mr.x+f,y:a.mr.y-g},bl:{x:a.mr.x-f,y:a.mr.y+g},br:{x:a.mr.x+g,y:a.mr.y+f}},a.mb.corner={tl:{x:a.mb.x-g,y:a.mb.y-f},tr:{x:a.mb.x+f,y:a.mb.y-g},bl:{x:a.mb.x-f,y:a.mb.y+g},br:{x:a.mb.x+g,y:a.mb.y+f}},a.mtr.corner={tl:{x:a.mtr.x-g+h*this.rotatingPointOffset,y:a.mtr.y-f-i*this.rotatingPointOffset},tr:{x:a.mtr.x+f+h*this.rotatingPointOffset,y:a.mtr.y-g-i*this.rotatingPointOffset},bl:{x:a.mtr.x-f+h*this.rotatingPointOffset,y:a.mtr.y+g-i*this.rotatingPointOffset},br:{x:a.mtr.x+g+h*this.rotatingPointOffset,y:a.mtr.y+f-i*this.rotatingPointOffset}}},drawBorders:function(a){if(this.hasBorders){var b=this.padding,c=2*b,d=this.strokeWidth>1?this.strokeWidth:0;a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=this.borderColor;var e=1/this._constrainScale(this.scaleX),f=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor,a.scale(e,f);var g=this.getWidth(),h=this.getHeight();if(a.strokeRect(~~(-(g/2)-b-d/2*this.scaleX)+.5,~~(-(h/2)-b-d/2*this.scaleY)+.5,~~(g+c+d*this.scaleX),~~(h+c+d*this.scaleY)),this.hasRotatingPoint&&!this.get("lockRotation")&&this.hasControls){var i=(this.flipY?h+d*this.scaleY+2*b:-h-d*this.scaleY-2*b)/2;a.beginPath(),a.moveTo(0,i),a.lineTo(0,i+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke()}return a.restore(),this}},drawControls:function(a){if(this.hasControls){var b,c,d=this.cornerSize,e=d/2,f=this.strokeWidth/2,g=-(this.width/2),h=-(this.height/2),i=d/this.scaleX,j=d/this.scaleY,k=this.padding/this.scaleX,l=this.padding/this.scaleY,m=e/this.scaleY,n=e/this.scaleX,o=(e-d)/this.scaleX,p=(e-d)/this.scaleY,q=this.height,r=this.width,s=this.transparentCorners?"strokeRect":"fillRect",t="undefined"!=typeof G_vmlCanvasManager;return a.save(),a.lineWidth=1/Math.max(this.scaleX,this.scaleY),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=a.fillStyle=this.cornerColor,b=g-n-f-k,c=h-m-f-l,t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g+r-n+f+k,c=h-m-f-l,t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g-n-f-k,c=h+q+p+f+l,t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g+r+o+f+k,c=h+q+p+f+l,t||a.clearRect(b,c,i,j),a[s](b,c,i,j),this.get("lockUniScaling")||(b=g+r/2-n,c=h-m-f-l,t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g+r/2-n,c=h+q+p+f+l,t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g+r+o+f+k,c=h+q/2-m,t||a.clearRect(b,c,i,j),a[s](b,c,i,j),b=g-n-f-k,c=h+q/2-m,t||a.clearRect(b,c,i,j),a[s](b,c,i,j)),this.hasRotatingPoint&&(b=g+r/2-n,c=this.flipY?h+q+this.rotatingPointOffset/this.scaleY-j/2+f+l:h-this.rotatingPointOffset/this.scaleY-j/2-f-l,t||a.clearRect(b,c,i,j),a[s](b,c,i,j)),a.restore(),this}}})}(),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d={x1:1,x2:1,y1:1,y2:1};return b.Line?void b.warn("fabric.Line is already defined"):(b.Line=b.util.createClass(b.Object,{type:"line",initialize:function(a,b){b=b||{},a||(a=[0,0,0,0]),this.callSuper("initialize",b),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={}),this.set("width",this.x2-this.x1||1),this.set("height",this.y2-this.y1||1),this.set("left","left"in a?a.left:this.x1+this.width/2),this.set("top","top"in a?a.top:this.y1+this.height/2)},_set:function(a,b){return this[a]=b,a in d&&this._setWidthHeight(),this},_render:function(a){a.beginPath(),this.group&&a.translate(-this.group.width/2+this.left,-this.group.height/2+this.top),a.moveTo(1===this.width?0:-this.width/2,1===this.height?0:-this.height/2),a.lineTo(1===this.width?0:this.width/2,1===this.height?0:this.height/2),a.lineWidth=this.strokeWidth;var b=a.strokeStyle;a.strokeStyle=a.fillStyle,a.stroke(),a.strokeStyle=b},complexity:function(){return 1},toObject:function(a){return c(this.callSuper("toObject",a),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(){var a=[];return this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!0)),a.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>'),a.join("")}}),b.Line.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" "),b.Line.fromElement=function(a,d){var e=b.parseAttributes(a,b.Line.ATTRIBUTE_NAMES),f=[e.x1||0,e.y1||0,e.x2||0,e.y2||0];return new b.Line(f,c(e,d))},b.Line.fromObject=function(a){var c=[a.x1,a.y1,a.x2,a.y2];return new b.Line(c,a)},void 0)}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){return"radius"in a&&a.radius>0}var c=a.fabric||(a.fabric={}),d=2*Math.PI,e=c.util.object.extend;return c.Circle?void c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",initialize:function(a){a=a||{},this.set("radius",a.radius||0),this.callSuper("initialize",a);var b=2*this.get("radius");this.set("width",b).set("height",b)},toObject:function(a){return e(this.callSuper("toObject",a),{radius:this.get("radius")})},toSVG:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),a.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),a.join("")},_render:function(a,b){a.beginPath(),a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity,a.arc(b?this.left:0,b?this.top:0,this.radius,0,d,!1),a.closePath(),this.fill&&a.fill(),this._removeShadow(a),this.stroke&&a.stroke()},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a,this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity opacity stroke stroke-width transform".split(" "),c.Circle.fromElement=function(a,d){d||(d={});var f=c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!b(f))throw new Error("value of `r` attribute is required and can not be negative");"left"in f&&(f.left-=d.width/2||0),"top"in f&&(f.top-=d.height/2||0);var g=new c.Circle(e(f,d));return g.cx=parseFloat(a.getAttribute("cx"))||0,g.cy=parseFloat(a.getAttribute("cy"))||0,g},c.Circle.fromObject=function(a){return new c.Circle(a)},void 0)}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Triangle?void b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(a){a=a||{},this.callSuper("initialize",a),this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,c),a.lineTo(0,-c),a.lineTo(b,c),a.closePath(),this.fill&&a.fill(),this.stroke&&a.stroke()},complexity:function(){return 1},toSVG:function(){var a=[],b=this.width/2,c=this.height/2,d=[-b+" "+c,"0 "+-c,b+" "+c].join(",");return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!0)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!0)),a.push("<polygon ",'points="',d,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),a.join("")}}),void(b.Triangle.fromObject=function(a){return new b.Triangle(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=2*Math.PI,d=b.util.object.extend;return b.Ellipse?void b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{},this.callSuper("initialize",a),this.set("rx",a.rx||0),this.set("ry",a.ry||0),this.set("width",2*this.get("rx")),this.set("height",2*this.get("ry"))},toObject:function(a){return d(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),a.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),a.join("")},render:function(a,b){return 0!==this.rx&&0!==this.ry?this.callSuper("render",a,b):void 0},_render:function(a,b){a.beginPath(),a.save(),a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&this.group&&a.translate(this.cx,this.cy),a.transform(1,0,0,this.ry/this.rx,0,0),a.arc(b?this.left:0,b?this.top:0,this.rx,0,c,!1),this.stroke&&a.stroke(),this._removeShadow(a),this.fill&&a.fill(),a.restore()},complexity:function(){return 1}}),b.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity opacity stroke stroke-width transform".split(" "),b.Ellipse.fromElement=function(a,c){c||(c={});var e=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES),f=e.left,g=e.top;"left"in e&&(e.left-=c.width/2||0),"top"in e&&(e.top-=c.height/2||0);var h=new b.Ellipse(d(e,c));return h.cx=f||0,h.cy=g||0,h},b.Ellipse.fromObject=function(a){return new b.Ellipse(a)},void 0)}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){return a.left=a.left||0,a.top=a.top||0,a}var c=a.fabric||(a.fabric={}),d=c.util.object.extend;return c.Rect?void console.warn("fabric.Rect is already defined"):(c.Rect=c.util.createClass(c.Object,{type:"rect",rx:0,ry:0,initialize:function(a){a=a||{},this._initStateProperties(),this.callSuper("initialize",a),this._initRxRy(),this.x=0,this.y=0},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a){var b=this.rx||0,c=this.ry||0,d=-this.width/2,e=-this.height/2,f=this.width,g=this.height;a.beginPath(),a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&this.group&&a.translate(this.width/2+this.x,this.height/2+this.y),!this.transformMatrix&&this.group&&a.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y),a.moveTo(d+b,e),a.lineTo(d+f-b,e),a.quadraticCurveTo(d+f,e,d+f,e+c,d+f,e+c),a.lineTo(d+f,e+g-c),a.quadraticCurveTo(d+f,e+g,d+f-b,e+g,d+f-b,e+g),a.lineTo(d+b,e+g),a.quadraticCurveTo(d,e+g,d,e+g-c,d,e+g-c),a.lineTo(d,e+c),a.quadraticCurveTo(d,e,d+b,e,d+b,e),a.closePath(),this.fill&&a.fill(),this._removeShadow(a),this.strokeDashArray?this._renderDashedStroke(a):this.stroke&&a.stroke()},_renderDashedStroke:function(a){function b(b,i){for(var j=0,k=0,l=(i?f.height:f.width)+2*g;l>j;){var m=f.strokeDashArray[c++];j+=m,j>l&&(k=j-l),b?d+=m*b-(k*b||0):e+=m*i-(k*i||0),a[1&c?"moveTo":"lineTo"](d,e),c>=h&&(c=0)}}1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray);var c=0,d=-this.width/2,e=-this.height/2,f=this,g=this.padding,h=this.strokeDashArray.length;a.save(),a.beginPath(),b(1,0),b(0,1),b(-1,0),b(0,-1),a.stroke(),a.closePath(),a.restore()},_normalizeLeftTopProperties:function(a){return a.left&&this.set("left",a.left+this.getWidth()/2),this.set("x",a.left||0),a.top&&this.set("top",a.top+this.getHeight()/2),this.set("y",a.top||0),this},complexity:function(){return 1},toObject:function(a){return d(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0})},toSVG:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),a.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),a.join("")}}),c.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity opacity stroke stroke-width transform".split(" "),c.Rect.fromElement=function(a,e){if(!a)return null;var f=c.parseAttributes(a,c.Rect.ATTRIBUTE_NAMES);f=b(f);var g=new c.Rect(d(e?c.util.object.clone(e):{},f));return g._normalizeLeftTopProperties(f),g},c.Rect.fromObject=function(a){return new c.Rect(a)},void 0)}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.toFixed;return b.Polyline?void b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",initialize:function(a,b,c){b=b||{},this.set("points",a),this.callSuper("initialize",b),this._calcDimensions(c)},_calcDimensions:function(a){return b.Polygon.prototype._calcDimensions.call(this,a)},toObject:function(a){return b.Polygon.prototype.toObject.call(this,a)},toSVG:function(){for(var a=[],b=[],d=0,e=this.points.length;e>d;d++)a.push(c(this.points[d].x,2),",",c(this.points[d].y,2)," ");return this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,!1)),b.push("<polyline ",'points="',a.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),b.join("")},_render:function(a){var b;a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;d>c;c++)b=this.points[c],a.lineTo(b.x,b.y);this.fill&&a.fill(),this._removeShadow(a),this.stroke&&a.stroke()},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" "),b.Polyline.fromElement=function(a,c){if(!a)return null;c||(c={});for(var d=b.parsePointsAttribute(a.getAttribute("points")),e=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES),f=0,g=d.length;g>f;f++)d[f].x-=c.width/2||0,d[f].y-=c.height/2||0;return new b.Polyline(d,b.util.object.extend(e,c),!0)},b.Polyline.fromObject=function(a){var c=a.points;return new b.Polyline(c,a,!0)},void 0)}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.toFixed;return b.Polygon?void b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Object,{type:"polygon",initialize:function(a,b,c){b=b||{},this.points=a,this.callSuper("initialize",b),this._calcDimensions(c)},_calcDimensions:function(a){var b=this.points,c=d(b,"x"),f=d(b,"y"),g=e(b,"x"),h=e(b,"y");if(this.width=g-c||1,this.height=h-f||1,this.minX=c,this.minY=f,!a){var i=this.width/2,j=this.height/2;this.points.forEach(function(a){a.x-=i,a.y-=j},this)}},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(){for(var a=[],b=[],c=0,d=this.points.length;d>c;c++)a.push(f(this.points[c].x,2),",",f(this.points[c].y,2)," ");return this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,!1)),b.push("<polygon ",'points="',a.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),b.join("")},_render:function(a){var b;a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;d>c;c++)b=this.points[c],a.lineTo(b.x,b.y);this.fill&&a.fill(),this._removeShadow(a),this.stroke&&(a.closePath(),a.stroke())},complexity:function(){return this.points.length}}),b.Polygon.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" "),b.Polygon.fromElement=function(a,d){if(!a)return null;d||(d={});for(var e=b.parsePointsAttribute(a.getAttribute("points")),f=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES),g=0,h=e.length;h>g;g++)e[g].x-=d.width/2||0,e[g].y-=d.height/2||0;return new b.Polygon(e,c(f,d),!0)},b.Polygon.fromObject=function(a){return new b.Polygon(a.points,a,!0)},void 0)}("undefined"!=typeof exports?exports:this),function(a){function b(a,b,e,f){for(var g=f[0],h=f[1],i=f[2],j=f[3],k=f[4],l=f[5],m=f[6],n=c(l,m,g,h,j,k,i,b,e),o=0;o<n.length;o++){var p=d.apply(this,n[o]);a.bezierCurveTo.apply(a,p)}}function c(a,b,c,d,e,f,h,j,l){if(g=k.call(arguments),i[g])return i[g];var m=h*(Math.PI/180),n=Math.sin(m),o=Math.cos(m);c=Math.abs(c),d=Math.abs(d);var p=o*(j-a)*.5+n*(l-b)*.5,q=o*(l-b)*.5-n*(j-a)*.5,r=p*p/(c*c)+q*q/(d*d);r>1&&(r=Math.sqrt(r),c*=r,d*=r);var s=o/c,t=n/c,u=-n/d,v=o/d,w=s*j+t*l,x=u*j+v*l,y=s*a+t*b,z=u*a+v*b,A=(y-w)*(y-w)+(z-x)*(z-x),B=1/A-.25;
0>B&&(B=0);var C=Math.sqrt(B);f===e&&(C=-C);var D=.5*(w+y)-C*(z-x),E=.5*(x+z)+C*(y-w),F=Math.atan2(x-E,w-D),G=Math.atan2(z-E,y-D),H=G-F;0>H&&1===f?H+=2*Math.PI:H>0&&0===f&&(H-=2*Math.PI);for(var I=Math.ceil(Math.abs(H/(.5*Math.PI+.001))),J=[],K=0;I>K;K++){var L=F+K*H/I,M=F+(K+1)*H/I;J[K]=[D,E,L,M,c,d,n,o]}return i[g]=J}function d(a,b,c,d,e,f,h,i){if(g=k.call(arguments),j[g])return j[g];var l=i*e,m=-h*f,n=h*e,o=i*f,p=.5*(d-c),q=8/3*Math.sin(.5*p)*Math.sin(.5*p)/Math.sin(p),r=a+Math.cos(c)-q*Math.sin(c),s=b+Math.sin(c)+q*Math.cos(c),t=a+Math.cos(d),u=b+Math.sin(d),v=t+q*Math.sin(d),w=u-q*Math.cos(d);return j[g]=[l*r+m*s,n*r+o*s,l*v+m*w,n*v+o*w,l*t+m*u,n*t+o*u]}function e(a){return"H"===a[0]?a[1]:a[a.length-2]}function f(a){return"V"===a[0]?a[1]:a[a.length-1]}var g,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={},j={},k=Array.prototype.join,l=a.fabric||(a.fabric={}),m=l.util.array.min,n=l.util.array.max,o=l.util.object.extend,p=Object.prototype.toString;return l.Path?void l.warn("fabric.Path is already defined"):(l.Path=l.util.createClass(l.Object,{type:"path",initialize:function(a,b){if(b=b||{},this.setOptions(b),!a)throw new Error("`path` argument is required");var c="[object Array]"===p.call(a);this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(c||(this.path=this._parsePath()),this._initializePath(b),b.sourcePath&&this.setSourcePath(b.sourcePath))},_initializePath:function(a){var b="width"in a,c="height"in a,d="left"in a,e="top"in a;b&&c?(e||(this.top=this.height/2),d||(this.left=this.width/2)):(o(this,this._parseDimensions()),b&&(this.width=a.width),c&&(this.height=a.height)),this.pathOffset=this._calculatePathOffset(e||d)},_calculatePathOffset:function(a){return{x:a?0:this.left-this.width/2,y:a?0:this.top-this.height/2}},_render:function(a){for(var c,d,e,f,g,h=null,i=0,j=0,k=0,l=0,m=-(this.width/2+this.pathOffset.x),n=-(this.height/2+this.pathOffset.y),o=0,p=this.path.length;p>o;++o){switch(c=this.path[o],c[0]){case"l":i+=c[1],j+=c[2],a.lineTo(i+m,j+n);break;case"L":i=c[1],j=c[2],a.lineTo(i+m,j+n);break;case"h":i+=c[1],a.lineTo(i+m,j+n);break;case"H":i=c[1],a.lineTo(i+m,j+n);break;case"v":j+=c[1],a.lineTo(i+m,j+n);break;case"V":j=c[1],a.lineTo(i+m,j+n);break;case"m":i+=c[1],j+=c[2],a[!h||"m"!==h[0]&&"M"!==h[0]?"moveTo":"lineTo"](i+m,j+n);break;case"M":i=c[1],j=c[2],a[!h||"m"!==h[0]&&"M"!==h[0]?"moveTo":"lineTo"](i+m,j+n);break;case"c":d=i+c[5],e=j+c[6],k=i+c[3],l=j+c[4],a.bezierCurveTo(i+c[1]+m,j+c[2]+n,k+m,l+n,d+m,e+n),i=d,j=e;break;case"C":i=c[5],j=c[6],k=c[3],l=c[4],a.bezierCurveTo(c[1]+m,c[2]+n,k+m,l+n,i+m,j+n);break;case"s":d=i+c[3],e=j+c[4],k=k?2*i-k:i,l=l?2*j-l:j,a.bezierCurveTo(k+m,l+n,i+c[1]+m,j+c[2]+n,d+m,e+n),k=i+c[1],l=j+c[2],i=d,j=e;break;case"S":d=c[3],e=c[4],k=2*i-k,l=2*j-l,a.bezierCurveTo(k+m,l+n,c[1]+m,c[2]+n,d+m,e+n),i=d,j=e,k=c[1],l=c[2];break;case"q":d=i+c[3],e=j+c[4],k=i+c[1],l=j+c[2],a.quadraticCurveTo(k+m,l+n,d+m,e+n),i=d,j=e;break;case"Q":d=c[3],e=c[4],a.quadraticCurveTo(c[1]+m,c[2]+n,d+m,e+n),i=d,j=e,k=c[1],l=c[2];break;case"t":d=i+c[1],e=j+c[2],null===h[0].match(/[QqTt]/)?(k=i,l=j):"t"===h[0]?(k=2*i-f,l=2*j-g):"q"===h[0]&&(k=2*i-k,l=2*j-l),f=k,g=l,a.quadraticCurveTo(k+m,l+n,d+m,e+n),i=d,j=e,k=i+c[1],l=j+c[2];break;case"T":d=c[1],e=c[2],k=2*i-k,l=2*j-l,a.quadraticCurveTo(k+m,l+n,d+m,e+n),i=d,j=e;break;case"a":b(a,i+m,j+n,[c[1],c[2],c[3],c[4],c[5],c[6]+i+m,c[7]+j+n]),i+=c[6],j+=c[7];break;case"A":b(a,i+m,j+n,[c[1],c[2],c[3],c[4],c[5],c[6]+m,c[7]+n]),i=c[6],j=c[7];break;case"z":case"Z":a.closePath()}h=c}},render:function(a,b){a.save();var c=this.transformMatrix;c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),b||this.transform(a),this.overlayFill?a.fillStyle=this.overlayFill:this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill),this.stroke&&(a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke),this._setShadow(a),this.clipTo&&l.util.clipContext(this,a),a.beginPath(),this._render(a),this.fill&&a.fill(),this.clipTo&&a.restore(),this._removeShadow(a),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=this.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke()),!b&&this.active&&(this.drawBorders(a),this.drawControls(a)),a.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){var b=o(this.callSuper("toObject",a),{path:this.path});return this.sourcePath&&(b.sourcePath=this.sourcePath),this.transformMatrix&&(b.transformMatrix=this.transformMatrix),b},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.path=this.sourcePath),delete b.sourcePath,b},toSVG:function(){for(var a=[],b=[],c=0,d=this.path.length;d>c;c++)a.push(this.path[c].join(" "));var e=a.join(" ");return this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,!0)),this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,!0)),b.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',e,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>"),b.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a,b,c,d,e=[],f=0,g=this.path.length;g>f;f++){a=this.path[f],b=a.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/),d=[a.charAt(0)];for(var i=0,j=b.length;j>i;i++)c=parseFloat(b[i]),isNaN(c)||d.push(c);var k=d[0].toLowerCase(),l=h[k];if(d.length-1>l)for(var m=1,n=d.length;n>m;m+=l)e.push([d[0]].concat(d.slice(m,m+l)));else e.push(d)}return e},_parseDimensions:function(){var a,b,c,d,g=[],h=[],i=!1;this.path.forEach(function(j,k){"H"!==j[0]&&(a=e(0===k?j:this.path[k-1])),"V"!==j[0]&&(b=f(0===k?j:this.path[k-1])),j[0]===j[0].toLowerCase()&&(i=!0),c=i?a+e(j):"V"===j[0]?a:e(j),d=i?b+f(j):"H"===j[0]?b:f(j);var l=parseInt(c,10);isNaN(l)||g.push(l),l=parseInt(d,10),isNaN(l)||h.push(l)},this);var j=m(g),k=m(h),l=n(g),o=n(h),p=l-j,q=o-k,r={top:k+q/2,left:j+p/2,bottom:n(h)-q,right:n(g)-p};return r.width=p,r.height=q,r}}),l.Path.fromObject=function(a){return new l.Path(a.path,a)},l.Path.ATTRIBUTE_NAMES="d fill fill-opacity opacity fill-rule stroke stroke-width transform".split(" "),l.Path.fromElement=function(a,b){var c=l.parseAttributes(a,l.Path.ATTRIBUTE_NAMES);return new l.Path(c.d,o(c,b))},void 0)}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){for(var b=0,d=a.length;d>b;b++)if(!(a[b]instanceof c.Object)){var e=g(h(a[b].type));a[b]=c[e].fromObject(a[b])}return a}var c=a.fabric||(a.fabric={}),d=c.util.object.extend,e=c.util.array.invoke,f=c.Object.prototype.toObject,g=c.util.string.camelize,h=c.util.string.capitalize;return c.PathGroup?void c.warn("fabric.PathGroup is already defined"):(c.PathGroup=c.util.createClass(c.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{},this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(b),this.setCoords(),b.sourcePath&&this.setSourcePath(b.sourcePath)},render:function(a){if(this.visible){a.save();var b=this.transformMatrix;b&&a.transform(b[0],b[1],b[2],b[3],b[4],b[5]),this.transform(a),this._setShadow(a),this.clipTo&&c.util.clipContext(this,a);for(var d=0,e=this.paths.length;e>d;++d)this.paths[d].render(a,!0);this.clipTo&&a.restore(),this._removeShadow(a),this.active&&(this.drawBorders(a),this.drawControls(a)),a.restore()}},_set:function(a,b){if(("fill"===a||"overlayFill"===a)&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){return d(f.call(this,a),{paths:e(this.getObjects(),"toObject",a),sourcePath:this.sourcePath})},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.paths=this.sourcePath),b},toSVG:function(){for(var a=this.getObjects(),b=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],c=0,d=a.length;d>c;c++)b.push(a[c].toSVG());return b.push("</g>"),b.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill");return this.getObjects().every(function(b){return b.get("fill")===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},toGrayscale:function(){for(var a=this.paths.length;a--;)this.paths[a].toGrayscale();return this},getObjects:function(){return this.paths}}),void(c.PathGroup.fromObject=function(a){var d=b(a.paths);return new c.PathGroup(d,a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.array.invoke,g=b.util.removeFromArray;if(!b.Group){var h={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,{type:"group",initialize:function(a,b){b=b||{},this.objects=a||[],this.originalState={},this.callSuper("initialize"),this._calcBounds(),this._updateObjectsCoords(),b&&c(this,b),this._setOpacityIfSame(),this.setCoords(!0),this.saveCoords()},_updateObjectsCoords:function(){var a=this.left,b=this.top;this.forEachObject(function(c){var d=c.get("left"),e=c.get("top");c.set("originalLeft",d),c.set("originalTop",e),c.set("left",d-a),c.set("top",e-b),c.setCoords(),c.__origHasControls=c.hasControls,c.hasControls=!1},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},addWithUpdate:function(a){return this._restoreObjectsState(),this.objects.push(a),this._calcBounds(),this._updateObjectsCoords(),this},removeWithUpdate:function(a){return this._restoreObjectsState(),g(this.objects,a),a.setActive(!1),this._calcBounds(),this._updateObjectsCoords(),this},add:function(a){return this.objects.push(a),this},remove:function(a){return g(this.objects,a),this},size:function(){return this.getObjects().length},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textShadow:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var c=this.objects.length;for(this[a]=b;c--;)this.objects[c].set(a,b)}else this[a]=b},contains:function(a){return this.objects.indexOf(a)>-1},toObject:function(a){return c(this.callSuper("toObject",a),{objects:f(this.objects,"toObject",a)})},render:function(a,c){a.save(),this.transform(a);var d=Math.max(this.scaleX,this.scaleY);this.clipTo&&b.util.clipContext(this,a);for(var e=this.objects.length;e>0;e--){var f=this.objects[e-1],g=f.borderScaleFactor,h=f.hasRotatingPoint;f.borderScaleFactor=d,f.hasRotatingPoint=!1,f.render(a),f.borderScaleFactor=g,f.hasRotatingPoint=h}this.clipTo&&a.restore(),!c&&this.active&&(this.drawBorders(a),this.drawControls(a)),a.restore(),this.setCoords()},item:function(a){return this.getObjects()[a]},complexity:function(){return this.getObjects().reduce(function(a,b){return a+="function"==typeof b.complexity?b.complexity():0},0)},_restoreObjectsState:function(){return this.objects.forEach(this._restoreObjectState,this),this},_restoreObjectState:function(a){var b=this.get("left"),c=this.get("top"),d=this.getAngle()*(Math.PI/180),e=Math.cos(d)*a.get("top")+Math.sin(d)*a.get("left"),f=-Math.sin(d)*a.get("top")+Math.cos(d)*a.get("left");return a.setAngle(a.getAngle()+this.getAngle()),a.set("left",b+f*this.get("scaleX")),a.set("top",c+e*this.get("scaleY")),a.set("scaleX",a.get("scaleX")*this.get("scaleX")),a.set("scaleY",a.get("scaleY")*this.get("scaleY")),a.setCoords(),a.hasControls=a.__origHasControls,delete a.__origHasControls,a.setActive(!1),a.setCoords(),this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(a){a.setCoords()}),this},activateAllObjects:function(){return this.forEachObject(function(a){a.setActive()}),this},forEachObject:b.StaticCanvas.prototype.forEachObject,_setOpacityIfSame:function(){var a=this.getObjects(),b=a[0]?a[0].get("opacity"):1,c=a.every(function(a){return a.get("opacity")===b});c&&(this.opacity=b)},_calcBounds:function(){for(var a,b,c,f,g,h,i,j=[],k=[],l=0,m=this.objects.length;m>l;++l){g=this.objects[l],g.setCoords();for(var n in g.oCoords)j.push(g.oCoords[n].x),k.push(g.oCoords[n].y)}a=d(j),c=e(j),b=d(k),f=e(k),h=c-a||0,i=f-b||0,this.width=h,this.height=i,this.left=a+h/2||0,this.top=b+i/2||0},containsPoint:function(a){var b=this.get("width")/2,c=this.get("height")/2,d=this.get("left"),e=this.get("top");return d-b<a.x&&d+b>a.x&&e-c<a.y&&e+c>a.y},toGrayscale:function(){for(var a=this.objects.length;a--;)this.objects[a].toGrayscale();return this},toSVG:function(){for(var a=[],b=this.objects.length;b--;)a.push(this.objects[b].toSVG());return'<g transform="'+this.getSvgTransform()+'">'+a.join("")+"</g>"},get:function(a){if(a in h){if(this[a])return this[a];for(var b=0,c=this.objects.length;c>b;b++)if(this.objects[b][a])return!0;return!1}return a in this.delegatedProperties?this.objects[0]&&this.objects[0].get(a):this[a]}}),b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects,c&&c(new b.Group(d,a))})},b.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=fabric.util.object.extend;return a.fabric||(a.fabric={}),a.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",initialize:function(a,b){b||(b={}),this.callSuper("initialize",b),this._initElement(a),this._originalImage=this.getElement(),this._initConfig(b),this.filters=[],b.filters&&(this.filters=b.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(a){return this._element=a,this._initConfig(),this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},render:function(a,b){a.save();var c=this.transformMatrix;this.group&&a.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2),c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),b||this.transform(a),this._setShadow(a),this.clipTo&&fabric.util.clipContext(this,a),this._render(a),this.clipTo&&a.restore(),this._removeShadow(a),this.active&&!b&&(this.drawBorders(a),this.drawControls(a)),a.restore()},toObject:function(a){return b(this.callSuper("toObject",a),{src:this._originalImage.src||this._originalImage._src,filters:this.filters.concat()})},toSVG:function(){return'<g transform="'+this.getSvgTransform()+'"><image xlink:href="'+this.getSvgSrc()+'" style="'+this.getSvgStyles()+'" transform="translate('+-this.width/2+" "+-this.height/2+')" width="'+this.width+'" height="'+this.height+'"></image></g>'},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,b){this.constructor.fromObject(this.toObject(b),a)},applyFilters:function(a){if(0===this.filters.length)return this.setElement(this._originalImage),void(a&&a());var b="undefined"!=typeof Buffer&&"undefined"==typeof window,c=this._originalImage,d=fabric.util.createCanvasElement(),e=b?new(require("canvas").Image):fabric.document.createElement("img"),f=this;if(d.width=c.width,d.height=c.height,d.getContext("2d").drawImage(c,0,0,c.width,c.height),this.filters.forEach(function(a){a&&a.applyTo(d)}),e.onload=function(){f._element=e,a&&a(),e.onload=d=c=null},e.width=c.width,e.height=c.height,b){var g=d.toDataURL("image/png").substring(22);e.src=new Buffer(g,"base64"),f._element=e,a&&a()}else e.src=d.toDataURL("image/png");return this},_render:function(a){a.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width),this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a)},_initFilters:function(a){a.filters&&a.filters.length&&(this.filters=a.filters.map(function(a){return a&&fabric.Image.filters[a.type].fromObject(a)}))},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement().width||0,this.height="height"in a?a.height:this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,b){var c=fabric.document.createElement("img"),d=a.src;a.width&&(c.width=a.width),a.height&&(c.height=a.height),c.onload=function(){fabric.Image.prototype._initFilters.call(a,a);var d=new fabric.Image(c,a);b&&b(d),c=c.onload=c.onerror=null},c.onerror=function(){fabric.log("Error loading "+c.src),b&&b(null,!0),c=c.onload=c.onerror=null},c.src=d},fabric.Image.fromURL=function(a,b,c){var d=fabric.document.createElement("img");d.onload=function(){b&&b(new fabric.Image(d,c)),d=d.onload=null},d.src=a},fabric.Image.ATTRIBUTE_NAMES="x y width height fill fill-opacity opacity stroke stroke-width transform xlink:href".split(" "),fabric.Image.fromElement=function(a,c,d){var e=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],c,b(d?fabric.util.object.clone(d):{},e))},fabric.Image.async=!0,void 0)}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;return a>0?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(a){a=a||{};var b=function(){},c=a.onComplete||b,d=a.onChange||b,e=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){e.setAngle(a),d()},onComplete:function(){e.setCoords(),c()},onStart:function(){e.setActive(!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.renderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters={},fabric.Image.filters.Grayscale=fabric.util.createClass({type:"Grayscale",applyTo:function(a){var b,c,d,e,f=a.getContext("2d"),g=f.getImageData(0,0,a.width,a.height),h=g.data,i=g.width,j=g.height;for(d=0;i>d;d++)for(e=0;j>e;e++)b=4*d*j+4*e,c=(h[b]+h[b+1]+h[b+2])/3,h[b]=c,h[b+1]=c,h[b+2]=c;f.putImageData(g,0,0)},toJSON:function(){return{type:this.type}}}),fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale},fabric.Image.filters.RemoveWhite=fabric.util.createClass({type:"RemoveWhite",initialize:function(a){a||(a={}),this.threshold=a.threshold||30,this.distance=a.distance||20},applyTo:function(a){for(var b,c,d,e=a.getContext("2d"),f=e.getImageData(0,0,a.width,a.height),g=f.data,h=this.threshold,i=this.distance,j=255-h,k=Math.abs,l=0,m=g.length;m>l;l+=4)b=g[l],c=g[l+1],d=g[l+2],b>j&&c>j&&d>j&&k(b-c)<i&&k(b-d)<i&&k(c-d)<i&&(g[l+3]=1);e.putImageData(f,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold,distance:this.distance}}}),fabric.Image.filters.RemoveWhite.fromObject=function(a){return new fabric.Image.filters.RemoveWhite(a)},fabric.Image.filters.Invert=fabric.util.createClass({type:"Invert",applyTo:function(a){var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=e.length;for(b=0;f>b;b+=4)e[b]=255-e[b],e[b+1]=255-e[b+1],e[b+2]=255-e[b+2];c.putImageData(d,0,0)},toJSON:function(){return{type:this.type}}}),fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert},fabric.Image.filters.Sepia=fabric.util.createClass({type:"Sepia",applyTo:function(a){var b,c,d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),f=e.data,g=f.length;for(b=0;g>b;b+=4)c=.3*f[b]+.59*f[b+1]+.11*f[b+2],f[b]=c+100,f[b+1]=c+50,f[b+2]=c+255;d.putImageData(e,0,0)},toJSON:function(){return{type:this.type}}}),fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia},fabric.Image.filters.Sepia2=fabric.util.createClass({type:"Sepia2",applyTo:function(a){var b,c,d,e,f=a.getContext("2d"),g=f.getImageData(0,0,a.width,a.height),h=g.data,i=h.length;for(b=0;i>b;b+=4)c=h[b],d=h[b+1],e=h[b+2],h[b]=(.393*c+.769*d+.189*e)/1.351,h[b+1]=(.349*c+.686*d+.168*e)/1.203,h[b+2]=(.272*c+.534*d+.131*e)/2.14;f.putImageData(g,0,0)},toJSON:function(){return{type:this.type}}}),fabric.Image.filters.Sepia2.fromObject=function(){return new fabric.Image.filters.Sepia2},fabric.Image.filters.Brightness=fabric.util.createClass({type:"Brightness",initialize:function(a){a||(a={}),this.brightness=a.brightness||100},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.brightness,f=0,g=d.length;g>f;f+=4)d[f]+=e,d[f+1]+=e,d[f+2]+=e;b.putImageData(c,0,0)},toJSON:function(){return{type:this.type,brightness:this.brightness}}}),fabric.Image.filters.Brightness.fromObject=function(a){return new fabric.Image.filters.Brightness(a)},fabric.Image.filters.Noise=fabric.util.createClass({type:"Noise",initialize:function(a){a||(a={}),this.noise=a.noise||100},applyTo:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=this.noise,g=0,h=e.length;h>g;g+=4)b=(.5-Math.random())*f,e[g]+=b,e[g+1]+=b,e[g+2]+=b;c.putImageData(d,0,0)},toJSON:function(){return{type:this.type,noise:this.noise}}}),fabric.Image.filters.Noise.fromObject=function(a){return new fabric.Image.filters.Noise(a)},fabric.Image.filters.GradientTransparency=fabric.util.createClass({type:"GradientTransparency",initialize:function(a){a||(a={}),this.threshold=a.threshold||100},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.threshold,f=d.length,g=0,h=d.length;h>g;g+=4)d[g+3]=e+255*(f-g)/f;b.putImageData(c,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold}}}),fabric.Image.filters.GradientTransparency.fromObject=function(a){return new fabric.Image.filters.GradientTransparency(a)},fabric.Image.filters.Tint=fabric.util.createClass({type:"Tint",initialize:function(a){a||(a={}),this.color=a.color||0},applyTo:function(a){var b,c,d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),f=e.data,g=f.length,h=parseInt(this.color,10).toString(16),i=parseInt("0x"+h.substr(0,2),16),j=parseInt("0x"+h.substr(2,2),16),k=parseInt("0x"+h.substr(4,2),16);for(b=0;g>b;b+=4)c=f[b+3],c>0&&(f[b]=i,f[b+1]=j,f[b+2]=k);d.putImageData(e,0,0)},toJSON:function(){return{type:this.type,color:this.color}}}),fabric.Image.filters.Tint.fromObject=function(a){return new fabric.Image.filters.Tint(a)},fabric.Image.filters.Convolute=fabric.util.createClass({type:"Convolute",initialize:function(a){a||(a={}),this.opaque=a.opaque,this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0];var b=fabric.util.createCanvasElement();this.tmpCtx=b.getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,b)},applyTo:function(a){for(var b=this.matrix,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=Math.round(Math.sqrt(b.length)),f=Math.floor(e/2),g=d.data,h=d.width,i=d.height,j=h,k=i,l=this._createImageData(j,k),m=l.data,n=this.opaque?1:0,o=0;k>o;o++)for(var p=0;j>p;p++){for(var q=o,r=p,s=4*(o*j+p),t=0,u=0,v=0,w=0,x=0;e>x;x++)for(var y=0;e>y;y++){var z=q+x-f,A=r+y-f;if(z>=0&&i>z&&A>=0&&h>A){var B=4*(z*h+A),C=b[x*e+y];t+=g[B]*C,u+=g[B+1]*C,v+=g[B+2]*C,w+=g[B+3]*C}}m[s]=t,m[s+1]=u,m[s+2]=v,m[s+3]=w+n*(255-w)}c.putImageData(l,0,0)},toJSON:function(){return{type:this.type,matrix:this.matrix}}}),fabric.Image.filters.Convolute.fromObject=function(a){return new fabric.Image.filters.Convolute(a)},fabric.Image.filters.Pixelate=fabric.util.createClass({type:"Pixelate",initialize:function(a){a||(a={}),this.blocksize=a.blocksize||4},applyTo:function(a){var b,c,d,e,f,g,h,i=a.getContext("2d"),j=i.getImageData(0,0,a.width,a.height),k=j.data,l=j.width,m=j.height;for(c=0;l>c;c+=this.blocksize)for(d=0;m>d;d+=this.blocksize){b=4*c*m+4*d,e=k[b],f=k[b+1],g=k[b+2],h=k[b+3];for(var n=c,o=c+this.blocksize;o>n;n++)for(var p=d,q=d+this.blocksize;q>p;p++)b=4*n*m+4*p,k[b]=e,k[b+1]=f,k[b+2]=g,k[b+3]=h}i.putImageData(j,0,0)},toJSON:function(){return{type:this.type,blocksize:this.blocksize}}}),fabric.Image.filters.Pixelate.fromObject=function(a){return new fabric.Image.filters.Pixelate(a)},function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.object.clone,e=b.util.toFixed;if(b.Text)return void b.warn("fabric.Text is already defined");var f={fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,strokeStyle:!0,strokeWidth:!0,text:!0},g=b.Object.prototype.stateProperties.concat();g.push("fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","strokeStyle","strokeWidth","backgroundColor","textBackgroundColor","useNative"),b.Text=b.util.createClass(b.Object,{fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textShadow:"",textAlign:"left",fontStyle:"",lineHeight:1.3,strokeStyle:"",strokeWidth:1,backgroundColor:"",textBackgroundColor:"",path:null,type:"text",useNative:!0,stateProperties:g,initialize:function(a,b){b=b||{},this.text=a,this.setOptions(b),this._initDimensions(),this.setCoords()},_initDimensions:function(){var a=b.util.createCanvasElement();this._render(a.getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){"undefined"==typeof Cufon||this.useNative===!0?this._renderViaNative(a):this._renderViaCufon(a)},_renderViaCufon:function(a){var b=Cufon.textOptions||(Cufon.textOptions={});b.left=this.left,b.top=this.top,b.context=a,b.color=this.fill;var c=this._initDummyElementForCufon();this.transform(a),Cufon.replaceElement(c,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor}),this.width=b.width,this.height=b.height,this._totalLineHeight=b.totalLineHeight,this._fontAscent=b.fontAscent,this._boundaries=b.boundaries,this._shadowOffsets=b.shadowOffsets,this._shadows=b.shadows||[],c=null,this.setCoords()},_renderViaNative:function(a){this.transform(a),this._setTextStyles(a);var c=this.text.split(/\r?\n/);this.width=this._getTextWidth(a,c),this.height=this._getTextHeight(a,c),this._renderTextBackground(a,c),"left"!==this.textAlign&&"justify"!==this.textAlign&&(a.save(),a.translate("center"===this.textAlign?this.width/2:this.width,0)),this._setTextShadow(a),this.clipTo&&b.util.clipContext(this,a),this._renderTextFill(a,c),this._renderTextStroke(a,c),this.clipTo&&a.restore(),this.textShadow&&a.restore(),"left"!==this.textAlign&&"justify"!==this.textAlign&&a.restore(),this._renderTextDecoration(a,c),this._setBoundaries(a,c),this._totalLineHeight=0,this.setCoords()},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,d=b.length;d>c;c++){var e=this._getLineWidth(a,b[c]),f=this._getLineLeftOffset(e);this._boundaries.push({height:this.fontSize*this.lineHeight,width:e,left:f})}},_setTextStyles:function(a){a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill,a.strokeStyle=this.strokeStyle,a.lineWidth=this.strokeWidth,a.textBaseline="alphabetic",a.textAlign=this.textAlign,a.font=this._getFontDeclaration()},_getTextHeight:function(a,b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]).width,d=1,e=b.length;e>d;d++){var f=a.measureText(b[d]).width;f>c&&(c=f)}return c},_setTextShadow:function(a){if(this.textShadow){var b=/\s+(-?\d+)(?:px)?\s+(-?\d+)(?:px)?\s+(\d+)(?:px)?\s*/,c=this.textShadow,d=b.exec(this.textShadow),e=c.replace(b,"");a.save(),a.shadowColor=e,a.shadowOffsetX=parseInt(d[1],10),a.shadowOffsetY=parseInt(d[2],10),a.shadowBlur=parseInt(d[3],10),this._shadows=[{blur:a.shadowBlur,color:a.shadowColor,offX:a.shadowOffsetX,offY:a.shadowOffsetY}],this._shadowOffsets=[[parseInt(a.shadowOffsetX,10),parseInt(a.shadowOffsetY,10)]]}},_drawTextLine:function(a,b,c,d,e){if("justify"!==this.textAlign)return void b[a](c,d,e);var f=b.measureText(c).width,g=this.width;if(g>f)for(var h=c.split(/\s+/),i=b.measureText(c.replace(/\s+/g,"")).width,j=g-i,k=h.length-1,l=j/k,m=0,n=0,o=h.length;o>n;n++)b[a](h[n],d+m,e),m+=b.measureText(h[n]).width+l;else b[a](c,d,e)},_renderTextFill:function(a,b){this._boundaries=[];for(var c=0,d=b.length;d>c;c++)this._drawTextLine("fillText",a,b[c],-this.width/2,-this.height/2+c*this.fontSize*this.lineHeight+this.fontSize)},_renderTextStroke:function(a,b){if(this.strokeStyle){a.beginPath();for(var c=0,d=b.length;d>c;c++)this._drawTextLine("strokeText",a,b[c],-this.width/2,-this.height/2+c*this.fontSize*this.lineHeight+this.fontSize);a.closePath()}},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a),this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(-this.width/2,-this.height/2,this.width,this.height),a.restore())},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor){a.save(),a.fillStyle=this.textBackgroundColor;for(var c=0,d=b.length;d>c;c++)if(""!==b[c]){var e=this._getLineWidth(a,b[c]),f=this._getLineLeftOffset(e);a.fillRect(-this.width/2+f,-this.height/2+c*this.fontSize*this.lineHeight,e,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_getLineWidth:function(a,b){return"justify"===this.textAlign?this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(c){for(var f=0,g=b.length;g>f;f++){var h=e._getLineWidth(a,b[f]),i=e._getLineLeftOffset(h);a.fillRect(-e.width/2+i,c+f*e.fontSize*e.lineHeight-d,h,1)}}var d=this._getTextHeight(a,b)/2,e=this;this.textDecoration.indexOf("underline")>-1&&c(this.fontSize),this.textDecoration.indexOf("line-through")>-1&&c(this.fontSize/2),this.textDecoration.indexOf("overline")>-1&&c(0)},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},_initDummyElementForCufon:function(){var a=b.document.createElement("pre"),c=b.document.createElement("div");return c.appendChild(a),"undefined"==typeof G_vmlCanvasManager?a.innerHTML=this.text:a.innerText=this.text.replace(/\r?\n/gi,"\r"),a.style.fontSize=this.fontSize+"px",a.style.letterSpacing="normal",a},render:function(a,b){a.save(),this._render(a),!b&&this.active&&(this.drawBorders(a),this.drawControls(a)),a.restore()},toObject:function(a){return c(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,path:this.path,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative})},toSVG:function(){var a=this.text.split(/\r?\n/),b=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,c=-(this.width/2),d=this.useNative?this.fontSize-1:this.height/2-a.length*this.fontSize-this._totalLineHeight,f=this._getSVGTextAndBg(b,c,a),g=this._getSVGShadows(b,a);
return d+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,['<g transform="',this.getSvgTransform(),'">',f.textBgRects.join(""),"<text ",this.fontFamily?"font-family=\"'"+this.fontFamily+"'\" ":"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',e(c,2)," ",e(d,2),')">',g.join(""),f.textSpans.join(""),"</text>","</g>"].join("")},_getSVGShadows:function(a,c){var d,f,g,h,i=[],j=1;if(!this._shadows||!this._boundaries)return i;for(d=0,g=this._shadows.length;g>d;d++)for(f=0,h=c.length;h>f;f++)if(""!==c[f]){var k=this._boundaries&&this._boundaries[f]?this._boundaries[f].left:0;i.push('<tspan x="',e(k+j+this._shadowOffsets[d][0],2),0===f||this.useNative?'" y':'" dy','="',e(this.useNative?a*f-this.height/2+this._shadowOffsets[d][1]:a+(0===f?this._shadowOffsets[d][1]:0),2),'" ',this._getFillAttributes(this._shadows[d].color),">",b.util.string.escapeXml(c[f]),"</tspan>"),j=1}else j++;return i},_getSVGTextAndBg:function(a,c,d){var f,g,h,i=[],j=[],k=1;for(this.backgroundColor&&this._boundaries&&j.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,2),'" y="',e(-this.height/2,2),'" width="',e(this.width,2),'" height="',e(this.height,2),'"></rect>'),f=0,h=d.length;h>f;f++)""!==d[f]?(g=this._boundaries&&this._boundaries[f]?e(this._boundaries[f].left,2):0,i.push('<tspan x="',g,'" ',0===f||this.useNative?"y":"dy",'="',e(this.useNative?a*f-this.height/2:a*k,2),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(d[f]),"</tspan>"),k=1):k++,this.textBackgroundColor&&this._boundaries&&j.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',e(c+this._boundaries[f].left,2),'" y="',e(a*f-this.height/2,2),'" width="',e(this._boundaries[f].width,2),'" height="',e(this._boundaries[f].height,2),'"></rect>');return{textSpans:i,textBgRects:j}},_getFillAttributes:function(a){var c=a?new b.Color(a):"";return c&&c.getSource()&&1!==c.getAlpha()?'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},setColor:function(a){return this.set("fill",a),this},getText:function(){return this.text},_set:function(a,b){"fontFamily"===a&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+b+"$3")),this.callSuper("_set",a,b),a in f&&(this._initDimensions(),this.setCoords())}}),b.Text.ATTRIBUTE_NAMES="x y fill fill-opacity opacity stroke stroke-width transform font-family font-style font-weight font-size text-decoration".split(" "),b.Text.fromObject=function(a){return new b.Text(a.text,d(a))},b.Text.fromElement=function(a,c){if(!a)return null;var d=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES);c=b.util.object.extend(c?b.util.object.clone(c):{},d);var e=new b.Text(a.textContent,c);return e.set({left:e.getLeft()+e.getWidth()/2,top:e.getTop()-e.getHeight()/2}),e},b.util.createAccessors(b.Text)}("undefined"!=typeof exports?exports:this),function(){function request(a,b,c){var d=URL.parse(a),e=HTTP.request({hostname:d.hostname,port:d.port,path:d.pathname,method:"GET"},function(a){var d="";b&&a.setEncoding(b),a.on("end",function(){c(d)}),a.on("data",function(b){200===a.statusCode&&(d+=b)})});e.on("error",function(a){fabric.log(a.errno===process.ECONNREFUSED?"ECONNREFUSED: connection refused to "+d.hostname+":"+d.port:a.message)})}function request_fs(a,b){var c=require("fs"),d=c.createReadStream(a),e="";d.on("data",function(a){e+=a}),d.on("end",function(){b(e)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=new require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(a,b,c){var d=function(d){e.src=new Buffer(d,"binary"),e._src=a,b&&b.call(c,e)},e=new Image;a&&0===a.indexOf("data")?(e.src=e._src=a,b&&b.call(c,e)):a&&0!==a.indexOf("http")?request_fs(a,d):a&&request(a,"binary",d)},fabric.loadSVGFromURL=function(a,b){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),request(a,"",function(a){fabric.loadSVGFromString(a,b)})},fabric.loadSVGFromString=function(a,b){var c=(new DOMParser).parseFromString(a);fabric.parseSVGDocument(c.documentElement,function(a,c){b(a,c)})},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(c){var d=new fabric.Image(c);d._initConfig(a),d._initFilters(a),b(d)})},fabric.createCanvasForNode=function(a,b){var c=fabric.document.createElement("canvas"),d=new Canvas(a||600,b||600);c.style={},c.width=d.width,c.height=d.height;var e=fabric.Canvas||fabric.StaticCanvas,f=new e(c);return f.contextContainer=d.getContext("2d"),f.nodeCanvas=d,f.Font=Canvas.Font,f},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a){return origSetWidth.call(this,a),this.nodeCanvas.width=a,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(a){return origSetHeight.call(this,a),this.nodeCanvas.height=a,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}(),function(){fabric.tapping_target=!1,fabric.tapping=!1;var a={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"},b=fabric.util.addListener,c=fabric.util.removeListener,d=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEvents:function(){var a=this;this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=function(b,c){a.__onTransformGesture(b,c)},b(fabric.window,"resize",this._onResize),fabric.isTouchSupported?(b(this.upperCanvasEl,"touchstart",this._onMouseDown),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof Event&&"add"in Event&&Event.add(this.upperCanvasEl,"gesture",this._onGesture)):(b(this.upperCanvasEl,"mousedown",this._onMouseDown),b(this.upperCanvasEl,"mousemove",this._onMouseMove))},_onMouseDown:function(a){fabric.tapping=!0;var d=this.findTarget(a);fabric.tapping_target=d?!0:!1,this.__onMouseDown(a),!fabric.isTouchSupported&&b(fabric.document,"mouseup",this._onMouseUp),fabric.isTouchSupported&&b(fabric.document,"touchend",this._onMouseUp),!fabric.isTouchSupported&&b(fabric.document,"mousemove",this._onMouseMove),fabric.isTouchSupported&&b(fabric.document,"touchmove",this._onMouseMove),!fabric.isTouchSupported&&c(this.upperCanvasEl,"mousemove",this._onMouseMove),fabric.isTouchSupported&&c(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(a){this.__onMouseUp(a),!fabric.isTouchSupported&&c(fabric.document,"mouseup",this._onMouseUp),fabric.isTouchSupported&&c(fabric.document,"touchend",this._onMouseUp),!fabric.isTouchSupported&&c(fabric.document,"mousemove",this._onMouseMove),fabric.isTouchSupported&&c(fabric.document,"touchmove",this._onMouseMove),!fabric.isTouchSupported&&b(this.upperCanvasEl,"mousemove",this._onMouseMove),fabric.isTouchSupported&&b(this.upperCanvasEl,"touchmove",this._onMouseMove),fabric.tapping_target=!1,fabric.tapping=!1},_onMouseMove:function(a){fabric.tapping=!1,(fabric.selection||!fabric.isTouchSupported||fabric.tapping_target)&&(a.preventDefault&&a.preventDefault(),this.__onMouseMove(a))},_onResize:function(){this.calcOffset()},__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)return this._isCurrentlyDrawing=!1,this.freeDrawingBrush.onMouseUp(),void this.fire("mouse:up",{e:a});if(this._currentTransform){var c=this._currentTransform;b=c.target,b._scaling&&(b._scaling=!1),b.isMoving=!1,b.setCoords(),this.stateful&&b.hasStateChanged()&&(this.fire("object:modified",{target:b}),b.fire("modified")),this._previousOriginX&&(this._currentTransform.target.adjustPosition(this._previousOriginX),this._previousOriginX=null)}this._currentTransform=null,this.selection&&this._groupSelector&&this._findSelectedObjects(a);var d=this.getActiveGroup();d&&(d.setObjectsCoords(),d.set("isMoving",!1),this._setCursor(this.defaultCursor)),this._groupSelector=null,this.renderAll(),this._setCursorFromEvent(a,b),this._setCursor("");var e=this;setTimeout(function(){e._setCursorFromEvent(a,b)},50),this.fire("mouse:up",{target:b,e:a}),b&&b.fire("mouseup",{e:a})},__onMouseDown:function(a){var b,c="which"in a?1===a.which:1===a.button;if(c||fabric.isTouchSupported){if(this.isDrawingMode)return b=this.getPointer(a),this._isCurrentlyDrawing=!0,this.discardActiveObject().renderAll(),this.freeDrawingBrush.onMouseDown(b),void this.fire("mouse:down",{e:a});if(!this._currentTransform){var d,e=this.findTarget(a);b=this.getPointer(a),this._shouldClearSelection(a,e)?(this._groupSelector={ex:b.x,ey:b.y,top:0,left:0},this.deactivateAllWithDispatch(),e&&e.selectable&&this.setActiveObject(e,a)):this._shouldHandleGroupLogic(a,e)?(this._handleGroupLogic(a,e),e=this.getActiveGroup()):(this.stateful&&e.saveState(),(d=e._findTargetCorner(a,this._offset))&&this.onBeforeScaleRotate(e),e!==this.getActiveGroup()&&e!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(e,a)),this._setupCurrentTransform(a,e)),this.renderAll(),this.fire("mouse:down",{target:e,e:a}),e&&e.fire("mousedown",{e:a}),"mtr"===d&&(this._previousOriginX=this._currentTransform.target.originX,this._currentTransform.target.adjustPosition("center"),this._currentTransform.left=this._currentTransform.target.left,this._currentTransform.top=this._currentTransform.target.top)}}},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)return this._isCurrentlyDrawing&&(c=this.getPointer(a),this.freeDrawingBrush.onMouseMove(c)),this.upperCanvasEl.style.cursor=this.freeDrawingCursor,void this.fire("mouse:move",{e:a});var e=this._groupSelector;if(e)c=d(a,this.upperCanvasEl),e.left=c.x-this._offset.left-e.ex,e.top=c.y-this._offset.top-e.ey,this.renderTop();else if(this._currentTransform){c=d(a,this.upperCanvasEl);var f=c.x,g=c.y,h=!1,i=this._currentTransform;b=i.target,b.isMoving=!0,"scale"!==i.action&&"scaleX"!==i.action&&"scaleY"!==i.action||(!a.altKey||"center"===i.originX&&"center"===i.originY)&&(a.altKey||"center"!==i.originX||"center"!==i.originY)||(this._resetCurrentTransform(a),h=!0),"rotate"===i.action?(this._rotateObject(f,g),this.fire("object:rotating",{target:b,e:a}),b.fire("rotating",{e:a})):"scale"===i.action?(!a.shiftKey&&!this.uniScaleTransform||b.get("lockUniScaling")?(h||"scale"!==i.currentAction||this._resetCurrentTransform(a),i.currentAction="scaleEqually",this._scaleObject(f,g,"equally")):(i.currentAction="scale",this._scaleObject(f,g)),this.fire("object:scaling",{target:b,e:a}),b.fire("scaling",{e:a})):"scaleX"===i.action?(this._scaleObject(f,g,"x"),this.fire("object:scaling",{target:b,e:a}),b.fire("scaling",{e:a})):"scaleY"===i.action?(this._scaleObject(f,g,"y"),this.fire("object:scaling",{target:b,e:a}),b.fire("scaling",{e:a})):(this._translateObject(f,g),this.fire("object:moving",{target:b,e:a}),b.fire("moving",{e:a}),this._setCursor(this.moveCursor)),this.renderAll()}else{var j=this.upperCanvasEl.style;if(b=this.findTarget(a),!b||b&&!b.selectable){for(var k=this._objects.length;k--;)this._objects[k]&&!this._objects[k].active&&this._objects[k].set("active",!1);j.cursor=this.defaultCursor}else this._setCursorFromEvent(a,b)}this.fire("mouse:move",{target:b,e:a}),b&&b.fire("mousemove",{e:a})},_setCursorFromEvent:function(b,c){var d=this.upperCanvasEl.style;if(!c)return d.cursor=this.defaultCursor,!1;var e=this.getActiveGroup(),f=c._findTargetCorner&&(!e||!e.contains(c))&&c._findTargetCorner(b,this._offset);if(f)if(f in a)d.cursor=a[f];else{if("mtr"!==f||!c.hasRotatingPoint)return d.cursor=this.defaultCursor,!1;d.cursor=this.rotationCursor}else d.cursor=this.hoverCursor;return!0}})}(),function(a){var b=function(){return this.pages=[],this.canvases=[],this.fabrics=[],this.uuid=this.Uuid(),this.script=this.CurrentlyExecutedScript(),this.parent=this.script.parentNode,this.json={documents:[]},this.width=1e3,this.height=1294,this.max_width=1e3,this.signature_document_url=this.script.getAttribute("data-signature-document-url"),this.style_width=this.calculateStyleWidth(),this.multiplier=this.calculateMultiplier(),this.style_height=this.calculateStyleHeight(),this.jafja=void 0,this};b.prototype.init=function(){this.script?(this.script.className+=" signature-document-script",this.script.id="signature-document-script-"+this.uuid,this._getDocument()):console.error("Could not find script tag to initialize on.")},b.prototype._getDocument=function(){var a=this;a._drawCss(),a._drawDocument(),a._drawPages(1),a.Get(a.signature_document_url,function(b){return a.json=b,a.page_count=a.json.documents[0].pages.length,a._drawPages(a.page_count),a._drawPagesBackgrounds(),a._drawPagesCanvases(),a.jafja.trigger("signature_document.rendered",{multiplier:a.multiplier,fabrics:a.fabrics}),!0})},b.prototype.calculateStyleWidth=function(){var a=this.parent.clientWidth||this.parent.offsetWidth;return Math.min(a,this.max_width)},b.prototype.calculateMultiplier=function(){return this.style_width/this.width},b.prototype.calculateStyleHeight=function(){return this.height*this.multiplier},b.prototype._calcOffset=function(){for(var a=0;a<this.fabrics.length;a++)this.fabrics[a].calcOffset()},b.prototype._drawDocument=function(){return this.document=document.createElement("article"),this.document.className="signature-document",this.document.id="signature-document-"+this.uuid,this.InsertAfter(this.script,this.document)},b.prototype._drawPagesBackgrounds=function(){for(var a=0;a<this.pages.length;a++){var b=this.json.documents[0].pages[a];this.pages[a].style.backgroundImage="url("+b.url+")"}return!0},b.prototype._drawPages=function(a){for(var b=0;a>b;b++)this.pages.length<=b&&this._drawPage(b+1);return!0},b.prototype._drawPage=function(a){var b=document.createElement("section");return b.className="signature-page",b.id="signature-page-"+a,b.style.width=this.style_width,b.style.height=this.style_height,b.style.maxWidth=this.max_width,this.pages.push(b),this.document.appendChild(b)},b.prototype._drawPagesCanvases=function(){for(var a=0;a<this.pages.length;a++)this._drawPageCanvas(a+1)},b.prototype._drawPageCanvas=function(a){var b=document.createElement("canvas");b.className="signature-document-canvas",b.id="signature-document-canvas-"+a,b.width=1e3,b.height=1294,this.pages[a-1].appendChild(b),this.canvases.push(b);var c=new fabric.Canvas("signature-document-canvas-"+a);return c.selection=!1,this._fabricEvents(c,a),c.setWidth(this.style_width),c.setHeight(this.style_height),c.calcOffset(),this.fabrics.push(c)},b.prototype._fireLastClick=function(a,b,c){this.last_click={page_number:b,x:a.getPointer(c).x||this.last_click.x,y:a.getPointer(c).y||this.last_click.y},this.jafja.trigger("signature_document.fabric.clicked",this.last_click)},b.prototype._fabricEvents=function(a,b){var c=this;a.on("mouse:down",function(d){d.e.targetTouches&&d.e.targetTouches.length>0&&c._fireLastClick(a,b,d.e)}),a.on("mouse:up",function(d){d.target||!fabric.tapping||c._fireLastClick(a,b,d.e)})},b.prototype.Uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=16*Math.random()|0,c="x"===a?b:3&b|8,c.toString(16)})},b.prototype.CurrentlyExecutedScript=function(){var a;if(document){var b=document.getElementsByTagName("script");a=b[b.length-1]}return a},b.prototype.InsertAfter=function(a,b){return a.parentNode.insertBefore(b,a.nextSibling)},b.prototype.Get=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(JSON.parse(c.responseText))},c.send()},b.prototype.getParam=function(a){return decodeURI((RegExp(a+"=(.+?)(&|$)").exec(location.search)||[,null])[1])},a.SignatureDocument=b}(this),MicroEvent.mixin(SignatureDocument);var signature_document=new SignatureDocument;!function(a){a.prototype._drawCss=function(){this.css='@charset "utf-8";.signature-document{box-sizing:border-box;position:relative;margin:0;padding:55px 0 70px 0;border:0;font-size:100%;vertical-align:baseline;font-family:Helvetica;font-size:.8rem;text-align:center;background:rgba(0,0,0,0.1)}.signature-page{margin:0;padding:0;-webkit-tap-highlight-color:rgba(0,0,0,0);background:#fff;background:#fff url() center center no-repeat;background-size:contain;background-repeat:no-repeat;margin:0 auto;margin-bottom:10px;text-align:left}';var a=document.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=this.css:a.appendChild(document.createTextNode(this.css)),document.body.appendChild(a)}}(SignatureDocument);